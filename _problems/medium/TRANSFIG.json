{"category_name":"medium","status":"success","problem_code":"TRANSFIG","problem_name":"Transfiguring Trees","body":"<span class=\"solution-visible-txt\">All submissions for this problem are available.<\/span><p>\nHermione has come home for the holidays after a grueling first year at Hogwarts. She then picks up a Muggle book on \"Graph Theory\" and starts reading about <b>rooted K-ary trees<\/b>: Trees that are rooted and in which each node has at most <b>K<\/b> children. Since Transfiguration is her favorite subject at Hogwarts, she excitedly starts inventing a spell to Transfigure some such trees into others.\n<\/p>\n<p>\nAfter a while, she has succeeded in her spell. However, she notices something strange about the transfigured tree. Suppose she started with the tree <b>T<\/b>, and transfigured it into tree <b>T'<\/b>. Then, she found that the preorder traversal of <b>T<\/b> was the same as the preorder traversal of <b>T'<\/b>, and that the postorder traversal of <b>T<\/b> was also the same as the postorder traversal of <b>T'<\/b>.\n<\/p>\n<p>\nShe then realizes that her spell is capable of transfiguring tree <b>T<\/b> into another tree <b>T'<\/b> only if the preorder and postorder traversals of both are the same. She thus wonders, given a particular permutation of nodes <b>P1<\/b> and another permutation of nodes <b>P2<\/b>, along with the value of <b>K<\/b>, how many rooted <b>K<\/b>-ary trees <b>T<\/b> are there that the preorder traversal of <b>T<\/b> is <b>P1<\/b>, and the postorder traversal of <b>T<\/b> is <b>P2<\/b>.\n<\/p>\n<p>\nWe give the explicit pseudocode of the preorder and postorder traversals of rooted <b>K<\/b>-ary trees:<\/p>\n<pre>\n<code>\nclass node\n\tint label;\n\tnode children[K];\n\/\/children[i] is \"null\" if the i'th child is not present\n\nvoid preorder(node subroot)\n\toutput subroot.label;\n\tfor(int i = 0; i &lt; K; i++)\n\t\tif(subroot.children[i] != null)\n\t\t\tpreorder(subroot.children[i]);\n\nvoid postorder(node subroot)\n\tfor(int i = 0; i &lt; K; i++)\n\t\tif(subroot.children[i] != null)\n\t\t\tpostorder(subroot.children[i]);\n\toutput subroot.label;\n<\/code>\n<\/pre>\n<p>\nTwo rooted <b>K<\/b>-ary trees <b>T1<\/b> and <b>T2<\/b> are considered different if there is some node <b>n<\/b>, such that the <b>children[]<\/b> array of node <b>n<\/b> is different in <b>T1<\/b> and in <b>T2<\/b>.\n<\/p>\n<p><pre>\nSome examples of differences:\nK=2.\n<code>\n   1 : (1.children = [2, 3])\n  \/ \\\n 2   3\n<\/code>\nis different from\n<code>\n   1 : (1.children = [3, 2])\n  \/ \\\n 3   2\n<\/code>\n\nAlso,\nK=2.\n<code>\n   1 : (1.children = [null, 2])\n    \\\n     2\n<\/code>\nis different from\n<code>\n   1 : (1.children = [2, null])\n  \/\n 2\n<\/code>\nis different from\n<code>\n   2\n    \\\n     1 : (1.children = [null, null], 2.children = [null, 1])\n<\/code>\n<\/pre><\/p>\n<h3>Input<\/h3>\n<p>\nThe first line contains <b>T<\/b>, the number of test-cases. <br \/><br \/>\nEach test-case, begins with a line consisting of two integers <b>N<\/b> and <b>K<\/b>, <b>N<\/b> is the number of nodes of the tree, and <b>K<\/b> is the maximum number of children of each node. <br \/><br \/>\nThis is followed by a line containing a <b>permutation of 1 to N<\/b>, the supposed preorder traversal. <br \/><br \/>\nThis is followed by another line containing a <b>permutation of 1 to N<\/b>, the supposed postorder traversal.\n<\/p>\n<h3>Output<\/h3>\n<p>\nFor each testcase, output the possible number of rooted <b>K<\/b>-ary trees having the first permutation as its preorder traversal and the second permutation as its postorder traversal. Since the answer can be large, output the answer modulo <b>1000000007<\/b> (<b>10<sup>9<\/sup> + 7<\/b>).\n<\/p>\n<h3>Constraints<\/h3>\n<ul>\n<li> <b>1<\/b> \u2264 <b>T<\/b> \u2264 <b>5<\/b> <\/li>\n<li> <b>2<\/b> \u2264 <b>N<\/b> \u2264 <b>10<sup>5<\/sup><\/b> <\/li>\n<li> <b>1<\/b> \u2264 <b>K<\/b> &lt; <b>N<\/b> <\/li>\n<li> Both lines will contain permutations of <b>1<\/b> to <b>N<\/b> <\/li>\n<\/ul>\n<h3>Example<\/h3>\n<pre>\n<b>Input:<\/b>\n4\n2 2\n1 2\n2 1\n4 2\n1 2 3 4\n2 3 4 1\n3 2\n2 1 3\n1 3 2\n4 3\n1 3 2 4\n2 1 3 4\n\n<b>Output:<\/b>\n2\n0\n1\n0\n<\/pre><h3>Explanation<\/h3>\n<p>\nThe first case has two possibilities:<\/p>\n<pre>\n<code>\n  1\n \/\n2\n<\/code>\nand\n<code>\n  1\n   \\\n    2\n<\/code>\n<\/pre>\n<p>\nThe second case gives us a tree where the root 1 has 2, 3 and 4 as its children. Since <b>K = 2<\/b>, this violates the condition that each node has <b>atmost K children<\/b>.\n<\/p>\n<p>\nThe fourth case is impossible for any tree to have the given preorder and postorder traversals.\n<\/p>\n","languages_supported":"ADA, ASM, BASH, BF, C, C99 strict, CAML, CLOJ, CLPS, CPP 4.3.2, CPP 4.9.2, CPP14, CS2, D, ERL, FORT, FS, GO, HASK, ICK, ICON, JAVA, JS, LISP clisp, LISP sbcl, LUA, NEM, NICE, NODEJS, PAS fpc, PAS gpc, PERL, PERL6, PHP, PIKE, PRLG, PYTH, PYTH 3.4, RUBY, SCALA, SCM guile, SCM qobi, ST, TCL, TEXT, WSPC","max_timelimit":"1","source_sizelimit":"50000","problem_author":"pragrame","problem_author_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #FF7F00;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>6&#9733;<\/span><span>pragrame<\/span>","problem_tester":"tuananh93","problem_tester_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #FFBF00;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>5&#9733;<\/span><span>tuananh93<\/span>","date_added":"7-06-2013","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/cook35'>\n                    cook35\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/medium'>\n                    medium\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/pragrame'>\n                    pragrame\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/tree'>\n                    tree\n                <\/a>","editorial_url":"http:\/\/discuss.codechef.com\/problems\/TRANSFIG","user":{"username":null},"time":{"view_start_date":1372012200,"submit_start_date":1372012200,"visible_start_date":1414769400,"end_date":1735669800,"current":1493557947},"todo":false,"problem_status":"unattempted"}