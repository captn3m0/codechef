{"category_name":"medium","status":"success","problem_code":"STRPOW","problem_name":"String Power","body":"### Read problem statements in [Bengali](https:\/\/www.codechef.com\/download\/translated\/APRIL21\/bengali\/STRPOW.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/APRIL21\/mandarin\/STRPOW.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/APRIL21\/russian\/STRPOW.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/APRIL21\/vietnamese\/STRPOW.pdf) as well.\r\n\r\nChef has been recently studying strings and probabilities and he came up with a problem for you.\r\n\r\nConsider an alphabet with $N$ characters (denoted by $c_1, c_2, \\ldots, c_N$). For each valid $i$, the character $c_i$ has a *power* $a_i$; the power of a string that contains only characters from this alphabet is the sum of their powers (if a character occurs multiple times, its power also occurs in the sum multiple times). For example, the power of a string $c_1c_2c_3$ is $a_1+a_2+a_3$ and the power of a string $c_1c_2c_1$ is $2 \\cdot a_1 + a_2$.\r\n\r\nAlso, for each valid $i$, you are given two parameters $p_i$ and $B_i$, where $p_i$ is a non-negative integer and $B_i \\in \\{0,1\\}$. For an integer $K$, we can construct a random string $S$ with length $K$ in the following way:\r\n- Define $R = \\sum\\limits_{i=1}^N p_i$.\r\n- First, each of the $K$ characters of $S$ is chosen independently. For each valid $i$ and $j$, the $i$-th character of $S$ is $c_j$ with probability $p_j\/R$.\r\n- Then, for each valid $i$, we compute the number of occurrences of $c_i$ in $S$ and if the parity of this number of occurrences (i.e. its remainder modulo $2$) is different from $B_i$, we discard the string $S$ and try to construct a new random string $S$ from the beginning.\r\n- Otherwise (if the parities of occurrences of all characters match the sequence $B$), we have constructed the random string $S$.\r\n- All parameters are chosen in such a way that there is at least one string we can generate without discarding it. In particular, $R \\gt 0$.\r\n\r\nWhat is the expected value of the power of the constructed string $S$? You need to answer $Q$ queries. In each query, you are given a different value of $K$ and you should find the expected power.\r\n\r\nFor each query, it can be proved that the expected power can be represented as a fraction $\\frac{P}{Q}$, where $P$ and $Q$ are non-negative integers and $Q$ is coprime with $998,244,353$. You need to compute $P \\cdot Q^{-1}$ modulo $998,244,353$, where $Q^{-1}$ denotes the multiplicative inverse of $Q$ modulo $998,244,353$.\r\n\r\n### Input\r\n- The first line of the input contains a single integer $N$.\r\n- $N$ lines follow. For each valid $i$, the $i$-th of these lines contains three space-separated integers $a_i$, $p_i$ and $B_i$.\r\n- The next line contains a single integer $Q$.\r\n- $Q$ lines follow. Each of these lines contains a single integer $K$ describing a query.\r\n\r\n### Output\r\nFor each query, print a single line containing one integer $P \\cdot Q^{-1}$ modulo $998,244,353$.\r\n\r\n### Constraints\r\n- $1 \\leq N \\leq 2,000$\r\n- $1 \\leq a_i \\leq 4 \\cdot 10^8$ for each valid $i$\r\n- $0 \\leq p_i \\leq 2,000$ for each valid $i$\r\n- $1 \\leq R \\leq 2,000$\r\n- $B_i \\in \\{0,1\\}$ for each valid $i$\r\n- $1 \\leq Q \\leq 2 \\cdot 10^4$\r\n- $1 \\leq K \\leq 4 \\cdot 10^8$\r\n\r\n### Subtasks\r\n**Subtask #1 (2 points, time limit 1 second):** $N, K \\leq 15$\r\n\r\n**Subtask #2 (8 points, time limit 1.5 seconds):**\r\n- $K \\leq 2,000$\r\n- $Q \\leq 10^4$\r\n\r\n**Subtask #3 (10 points, time limit 1.5 seconds):** $N, R \\leq 400$\r\n\r\n**Subtask #4 (80 points, time limit 2.5 seconds):** original constraints\r\n\r\n### Example Input\r\n```\r\n2\r\n1 1 0\r\n2 2 1\r\n2\r\n1\r\n3\r\n```\r\n\r\n### Example Output\r\n```\r\n2\r\n855638022\r\n```\r\n\t\r\n### Explanation\r\nIn the first query, we can only generate the one-character string $c_2$. Therefore, the expected power is $2$.\r\n\r\nIn the second query, we can generate the following strings:\r\n- $c_1c_1c_2$ with power $4$ and probability $2\/14$\r\n- $c_1c_2c_1$ with power $4$ and probability $2\/14$\r\n- $c_2c_1c_1$ with power $4$ and probability $2\/14$\r\n- $c_2c_2c_2$ with power $6$ and probability $8\/14$\r\n\r\nThe expected power is therefore $\\frac{2 \\cdot 4 + 2 \\cdot 4 + 2 \\cdot 4 + 8 \\cdot 6}{2+2+2+8} = \\frac{36}{7} = 855,638,022$.\r\n\n<aside style='background: #f8f8f8;padding: 10px 15px;'><div>All submissions for this problem are available.<\/div><\/aside>","problemComponents":{"constraints":"","constraintsState":false,"subtasks":"","subtasksState":false,"statement":"### Read problem statements in [Bengali](https:\/\/www.codechef.com\/download\/translated\/APRIL21\/bengali\/STRPOW.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/APRIL21\/mandarin\/STRPOW.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/APRIL21\/russian\/STRPOW.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/APRIL21\/vietnamese\/STRPOW.pdf) as well.\r\n\r\nChef has been recently studying strings and probabilities and he came up with a problem for you.\r\n\r\nConsider an alphabet with $N$ characters (denoted by $c_1, c_2, \\ldots, c_N$). For each valid $i$, the character $c_i$ has a *power* $a_i$; the power of a string that contains only characters from this alphabet is the sum of their powers (if a character occurs multiple times, its power also occurs in the sum multiple times). For example, the power of a string $c_1c_2c_3$ is $a_1+a_2+a_3$ and the power of a string $c_1c_2c_1$ is $2 \\cdot a_1 + a_2$.\r\n\r\nAlso, for each valid $i$, you are given two parameters $p_i$ and $B_i$, where $p_i$ is a non-negative integer and $B_i \\in \\{0,1\\}$. For an integer $K$, we can construct a random string $S$ with length $K$ in the following way:\r\n- Define $R = \\sum\\limits_{i=1}^N p_i$.\r\n- First, each of the $K$ characters of $S$ is chosen independently. For each valid $i$ and $j$, the $i$-th character of $S$ is $c_j$ with probability $p_j\/R$.\r\n- Then, for each valid $i$, we compute the number of occurrences of $c_i$ in $S$ and if the parity of this number of occurrences (i.e. its remainder modulo $2$) is different from $B_i$, we discard the string $S$ and try to construct a new random string $S$ from the beginning.\r\n- Otherwise (if the parities of occurrences of all characters match the sequence $B$), we have constructed the random string $S$.\r\n- All parameters are chosen in such a way that there is at least one string we can generate without discarding it. In particular, $R \\gt 0$.\r\n\r\nWhat is the expected value of the power of the constructed string $S$? You need to answer $Q$ queries. In each query, you are given a different value of $K$ and you should find the expected power.\r\n\r\nFor each query, it can be proved that the expected power can be represented as a fraction $\\frac{P}{Q}$, where $P$ and $Q$ are non-negative integers and $Q$ is coprime with $998,244,353$. You need to compute $P \\cdot Q^{-1}$ modulo $998,244,353$, where $Q^{-1}$ denotes the multiplicative inverse of $Q$ modulo $998,244,353$.\r\n\r\n### Input\r\n- The first line of the input contains a single integer $N$.\r\n- $N$ lines follow. For each valid $i$, the $i$-th of these lines contains three space-separated integers $a_i$, $p_i$ and $B_i$.\r\n- The next line contains a single integer $Q$.\r\n- $Q$ lines follow. Each of these lines contains a single integer $K$ describing a query.\r\n\r\n### Output\r\nFor each query, print a single line containing one integer $P \\cdot Q^{-1}$ modulo $998,244,353$.\r\n\r\n### Constraints\r\n- $1 \\leq N \\leq 2,000$\r\n- $1 \\leq a_i \\leq 4 \\cdot 10^8$ for each valid $i$\r\n- $0 \\leq p_i \\leq 2,000$ for each valid $i$\r\n- $1 \\leq R \\leq 2,000$\r\n- $B_i \\in \\{0,1\\}$ for each valid $i$\r\n- $1 \\leq Q \\leq 2 \\cdot 10^4$\r\n- $1 \\leq K \\leq 4 \\cdot 10^8$\r\n\r\n### Subtasks\r\n**Subtask #1 (2 points, time limit 1 second):** $N, K \\leq 15$\r\n\r\n**Subtask #2 (8 points, time limit 1.5 seconds):**\r\n- $K \\leq 2,000$\r\n- $Q \\leq 10^4$\r\n\r\n**Subtask #3 (10 points, time limit 1.5 seconds):** $N, R \\leq 400$\r\n\r\n**Subtask #4 (80 points, time limit 2.5 seconds):** original constraints","inputFormat":"","inputFormatState":false,"outputFormat":"","outputFormatState":false,"sampleTestCases":[{"id":"1","input":"2\r\n1 1 0\r\n2 2 1\r\n2\r\n1\r\n3","output":"2\r\n855638022","explanation":"In the first query, we can only generate the one-character string $c_2$. Therefore, the expected power is $2$.\r\n\r\nIn the second query, we can generate the following strings:\r\n- $c_1c_1c_2$ with power $4$ and probability $2\/14$\r\n- $c_1c_2c_1$ with power $4$ and probability $2\/14$\r\n- $c_2c_1c_1$ with power $4$ and probability $2\/14$\r\n- $c_2c_2c_2$ with power $6$ and probability $8\/14$\r\n\r\nThe expected power is therefore $\\frac{2 \\cdot 4 + 2 \\cdot 4 + 2 \\cdot 4 + 8 \\cdot 6}{2+2+2+8} = \\frac{36}{7} = 855,638,022$.","isDeleted":false}]},"video_editorial_url":"https:\/\/youtu.be\/bHldNXbzyWM","languages_supported":"CPP14, C, JAVA, PYTH 3.6, CPP17, PYTH, PYP3, CS2, ADA, PYPY, TEXT, PAS fpc, NODEJS, RUBY, PHP, GO, HASK, TCL, PERL, SCALA, LUA, kotlin, BASH, JS, LISP sbcl, rust, PAS gpc, BF, CLOJ, R, D, CAML, FORT, ASM, swift, FS, WSPC, LISP clisp, SQL, SCM guile, PERL6, ERL, CLPS, ICK, NICE, PRLG, ICON, COB, SCM chicken, PIKE, SCM qobi, ST, SQLQ, NEM","max_timelimit":"1 - 2.5","source_sizelimit":"50000","problem_author":"samarth2017","problem_author_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #FF7F00;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>6&#9733;<\/span><span class='m-username--link'>samarth2017<\/span>","problem_tester":"","problem_tester_html_handle":"","date_added":"24-03-2021","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/april21'>april21<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/dynamic-programming'>dynamic-programming<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/expected-value'>expected-value<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/generating-functions'>generating-functions<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/hard'>hard<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/samarth2017'>samarth2017<\/a>","problem_difficulty_level":"Hard","user_zen_mode":false,"best_tag":"Dynamic Programming","editorial_url":"https:\/\/discuss.codechef.com\/problems\/STRPOW","time":{"view_start_date":1618219800,"submit_start_date":1618219800,"visible_start_date":1618219800,"end_date":1735669800,"current":1643797980},"user":{"username":null,"access":"default"},"todo":false,"problem_status":"unattempted","is_direct_submittable":false,"problemDiscussURL":"https:\/\/discuss.codechef.com\/search?q=STRPOW","is_proctored":false,"is_user_verified_for_proctoring":null,"visitedContests":[]}