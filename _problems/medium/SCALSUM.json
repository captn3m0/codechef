{"category_name":"medium","status":"success","problem_code":"SCALSUM","problem_name":"Scalar Product Tree","body":"### Read problem statements in [Hindi](https:\/\/www.codechef.com\/download\/translated\/NOV20\/hindi\/SCALSUM.pdf), [Bengali](https:\/\/www.codechef.com\/download\/translated\/NOV20\/bengali\/SCALSUM.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/NOV20\/mandarin\/SCALSUM.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/NOV20\/russian\/SCALSUM.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/NOV20\/vietnamese\/SCALSUM.pdf) as well.\r\n\r\nChef has a tree with $N$ vertices (numbered $1$ through $N$). The tree is rooted at the vertex $1$. For each valid $i$, the weight of the $i$-th vertex is $w_i$.\r\n\r\nFor a vertex $u$ with depth $d$ (the root has depth $1$), let's denote the sequence of vertices on the path from $u$ to the root by $(v_1, v_2, \\ldots, v_d)$, where $v_1 = u$ and $v_d = 1$. Then, let $F_u$ be the vector (i.e. sequence) $(w_{v_1}, w_{v_2}, \\ldots, w_{v_d})$, where the $i$-th element is $F_{u, i} = w_{v_i}$ for each valid $i$.\r\n\r\nFor any two vertices $u$ and $v$ with the same depth $d$, let's define the [dot product](https:\/\/en.wikipedia.org\/wiki\/Dot_product) $F_u \\cdot F_v = \\sum_{i=1}^d F_{u,i} \\cdot F_{v,i}$.\r\n\r\nYour task is to answer $Q$ queries. In each query, you are given two vertices $u$ and $v$ with the same depth, and you should find $F_u \\cdot F_v$. Since the dot product can be large, compute it modulo $2^{32}$.\r\n\r\n### Input\r\n- The first line of the input contains two space-separated integers $N$ and $Q$.\r\n- The second line contains $N$ space-separated integers $w_1, w_2, \\ldots, w_N$.\r\n- Each of the next $N-1$ lines contains two space-separated integers $u$ and $v$ denoting that vertices $u$ and $v$ are connected by an edge.\r\n- $Q$ lines follow. Each of these lines contains two space-separated integers $u$ and $v$ describing a query.\r\n\r\n### Output\r\nFor each query, print a single line containing one integer $F_u \\cdot F_v$ modulo $2^{32}$.\r\n\r\n### Constraints \r\n- $1 \\le N, Q \\le 3 \\cdot 10^5$\r\n- $1 \\le w_i \\le 10^9$ for each valid $i$\r\n- $1 \\le u, v \\le N$\r\n- in each query, $u$ and $v$ have the same depth\r\n\r\n### Subtasks\r\n**Subtask #1 (15 points, time limit 1 second):** $N, Q \\le 1,000$\r\n\r\n**Subtask #2 (45 points, time limit 2 seconds):** $N, Q \\le 10^5$\r\n\r\n**Subtask #3 (40 points, time limit 3.5 seconds):** original constraints\r\n\r\n### Example Input\r\n```\r\n5 2\r\n5 4 3 2 1\r\n1 2\r\n1 3\r\n2 4\r\n2 5\r\n2 3\r\n4 5\r\n```\r\n\r\n### Example Output\r\n```\r\n37\r\n43\r\n```\r\n\r\n### Explanation\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/NOV20\/SCALSUM\/SCALSUM.png)\r\n\r\nIn the first query, $F_2 = (4,5)$ and $F_3 = (3,5)$, so the scalar product is $4 \\cdot 3 + 5 \\cdot 5 = 37$.\r\n\r\nIn the second query, $F_4 = (2,4,5)$ and $F_5 = (1,4,5)$, so the scalar product is $2 \\cdot 1 + 4 \\cdot 4 + 5 \\cdot 5 = 43$. \r\n\n<aside style='background: #f8f8f8;padding: 10px 15px;'><div>All submissions for this problem are available.<\/div><\/aside>","problemComponents":{"constraints":"","constraintsState":false,"subtasks":"","subtasksState":false,"statement":"### Read problem statements in [Hindi](https:\/\/www.codechef.com\/download\/translated\/NOV20\/hindi\/SCALSUM.pdf), [Bengali](https:\/\/www.codechef.com\/download\/translated\/NOV20\/bengali\/SCALSUM.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/NOV20\/mandarin\/SCALSUM.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/NOV20\/russian\/SCALSUM.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/NOV20\/vietnamese\/SCALSUM.pdf) as well.\r\n\r\nChef has a tree with $N$ vertices (numbered $1$ through $N$). The tree is rooted at the vertex $1$. For each valid $i$, the weight of the $i$-th vertex is $w_i$.\r\n\r\nFor a vertex $u$ with depth $d$ (the root has depth $1$), let's denote the sequence of vertices on the path from $u$ to the root by $(v_1, v_2, \\ldots, v_d)$, where $v_1 = u$ and $v_d = 1$. Then, let $F_u$ be the vector (i.e. sequence) $(w_{v_1}, w_{v_2}, \\ldots, w_{v_d})$, where the $i$-th element is $F_{u, i} = w_{v_i}$ for each valid $i$.\r\n\r\nFor any two vertices $u$ and $v$ with the same depth $d$, let's define the [dot product](https:\/\/en.wikipedia.org\/wiki\/Dot_product) $F_u \\cdot F_v = \\sum_{i=1}^d F_{u,i} \\cdot F_{v,i}$.\r\n\r\nYour task is to answer $Q$ queries. In each query, you are given two vertices $u$ and $v$ with the same depth, and you should find $F_u \\cdot F_v$. Since the dot product can be large, compute it modulo $2^{32}$.\r\n\r\n### Input\r\n- The first line of the input contains two space-separated integers $N$ and $Q$.\r\n- The second line contains $N$ space-separated integers $w_1, w_2, \\ldots, w_N$.\r\n- Each of the next $N-1$ lines contains two space-separated integers $u$ and $v$ denoting that vertices $u$ and $v$ are connected by an edge.\r\n- $Q$ lines follow. Each of these lines contains two space-separated integers $u$ and $v$ describing a query.\r\n\r\n### Output\r\nFor each query, print a single line containing one integer $F_u \\cdot F_v$ modulo $2^{32}$.\r\n\r\n### Constraints \r\n- $1 \\le N, Q \\le 3 \\cdot 10^5$\r\n- $1 \\le w_i \\le 10^9$ for each valid $i$\r\n- $1 \\le u, v \\le N$\r\n- in each query, $u$ and $v$ have the same depth\r\n\r\n### Subtasks\r\n**Subtask #1 (15 points, time limit 1 second):** $N, Q \\le 1,000$\r\n\r\n**Subtask #2 (45 points, time limit 2 seconds):** $N, Q \\le 10^5$\r\n\r\n**Subtask #3 (40 points, time limit 3.5 seconds):** original constraints","inputFormat":"","inputFormatState":false,"outputFormat":"","outputFormatState":false,"sampleTestCases":[{"id":"1","input":"5 2\r\n5 4 3 2 1\r\n1 2\r\n1 3\r\n2 4\r\n2 5\r\n2 3\r\n4 5","output":"37\r\n43","explanation":"![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/NOV20\/SCALSUM\/SCALSUM.png)\r\n\r\nIn the first query, $F_2 = (4,5)$ and $F_3 = (3,5)$, so the scalar product is $4 \\cdot 3 + 5 \\cdot 5 = 37$.\r\n\r\nIn the second query, $F_4 = (2,4,5)$ and $F_5 = (1,4,5)$, so the scalar product is $2 \\cdot 1 + 4 \\cdot 4 + 5 \\cdot 5 = 43$.","isDeleted":false}]},"video_editorial_url":"https:\/\/youtu.be\/-n6QKiOtr3w","languages_supported":"CPP14, C, JAVA, PYTH 3.6, CPP17, PYTH, PYP3, CS2, ADA, PYPY, TEXT, PAS fpc, NODEJS, RUBY, PHP, GO, HASK, TCL, PERL, SCALA, LUA, kotlin, BASH, JS, LISP sbcl, rust, PAS gpc, BF, CLOJ, R, D, CAML, FORT, ASM, swift, FS, WSPC, LISP clisp, SQL, SCM guile, PERL6, ERL, CLPS, ICK, NICE, PRLG, ICON, COB, SCM chicken, PIKE, SCM qobi, ST, SQLQ, NEM","max_timelimit":"1 - 3.5","source_sizelimit":"50000","problem_author":"kobor","problem_author_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #684273;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>4&#9733;<\/span><span class='m-username--link'>kobor<\/span>","problem_tester":"","problem_tester_html_handle":"","date_added":"17-10-2020","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/kobor'>kobor<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/medium'>medium<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/nov20'>nov20<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/pre-computation'>pre-computation<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/square-root-decomposition'>square-root-decomposition<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/trees'>trees<\/a>","problem_difficulty_level":"Medium","user_zen_mode":false,"best_tag":"Pre Computation","editorial_url":"https:\/\/discuss.codechef.com\/problems\/SCALSUM","time":{"view_start_date":1104528600,"submit_start_date":1104528600,"visible_start_date":1104528600,"end_date":1735669800,"current":1643797975},"user":{"username":null,"access":"default"},"todo":false,"problem_status":"unattempted","is_direct_submittable":false,"problemDiscussURL":"https:\/\/discuss.codechef.com\/search?q=SCALSUM","is_proctored":false,"is_user_verified_for_proctoring":null,"visitedContests":[]}