{"category_name":"medium","status":"success","problem_code":"LADCOMP","problem_name":"Madoka and Ladder Decomposition","body":"### Read problem statements in [Bengali](https:\/\/www.codechef.com\/download\/translated\/JULY21\/bengali\/LADCOMP.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/JULY21\/mandarin\/LADCOMP.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/JULY21\/russian\/LADCOMP.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/JULY21\/vietnamese\/LADCOMP.pdf) as well.\n\nMadoka was given a tree on her coming of age, and not a simple one, but a rooted tree of $n$ vertices with a root at the vertex with the number $1$.\n\nFor all $i\\ge 2$, let $P_i$ ($1 \\leq P_i \\leq i - 1$) be the parent of the vertex $i$.\n\nLet's define the depth array $h$ as follows: $h_1 = 1$, and $h_i = h_{P_i} + 1$ for all $i \\ge 2$.\n\nThe subtree of a vertex $u$, denoted $S(u)$, is defined as the set of vertices $v$ such that the unique path from $1$ to $v$ contains $u$. Also, we define $$\\mathrm{val}_u = \\max \\{h(v) : v\\in S(u)\\}.$$\n\nA tree is divided into paths by a ladder decomposition if each vertex is located on exactly one path, and each vertex $u$ with at least one child lies in the same path as its child $v$ with the maximum $\\mathrm{val}_v$, and if there are several such vertices, then the vertex with the minimum number is selected.\n\nMadoka defines the beauty of a tree in the following way. Let the ladder decomposition of the path lengths be $L_1, \\dots, L_k$, then the beauty of the tree is $L_1^2 + L_2^2 + \\cdots + L_k^2$\n\nFor each $i$ ($1\\le i\\le n$), your task is to calculate the beauty of the tree formed by the first $i$ vertices.\n\n### Input\n\n- The first line contains an integer $T$ - the number of test cases. Then $T$ test cases follow.\n- The first line of each test case contains a single integer $n$ - the size of the tree.\n- The second line contains $n-1$ integers $P_2, \\ldots, P_n$.\n\n### Output\nFor each test case, print in a separate line a single integer - the answer to the problem.\n\n### Constraints\n- $1 \\leq T \\leq 10$\n- $2 \\leq n \\leq 8 \\cdot 10^5$\n- $1\\le P_i \\lt i$ for all $2\\le i\\le n$\n- The sum of $n$ over all test cases is at most $8 \\cdot 10^5$\n\n### Subtasks\n\n- **Subtask 1 (10 points):** \n    - The sum of $n$ is at most $2\\cdot 10^3$.\n    - The time limit is $1$ second.\n- **Subtask 2 (20 points):**\n    - $h_i\\leq 3$ for all $i$.\n    - The sum of $n$ is at most $10^5$.\n    - The time limit is $1$ second.\n- **Subtask 3 (50 points):**\n    - The sum of $n$ is at most $2\\cdot 10^5$.\n    - The time limit is $1$ second.\n- **Subtask 4 (20 points):**\n    - Original constraints.\n    - The time limit is $2.2$ seconds.\n\n### Sample Input\n```\n2\n6\n1 2 1 4 3\n12\n1 2 1 4 4 6 2 8 5 6 11\n```\n\n### Sample Output\n```\n0 1 4 4 5 10\n0 1 4 4 5 5 10 10 13 14 14 21\n```\n\n### Explanation\n<img src=\"https:\/\/i.ibb.co\/VDnNs3r\/2.png\" class=\"center\" width=\"774\" height=\"713\">\n\n\n<aside style='background: #f8f8f8;padding: 10px 15px;'><div>All submissions for this problem are available.<\/div><\/aside>","problemComponents":{"constraints":"","constraintsState":false,"subtasks":"","subtasksState":false,"statement":"### Read problem statements in [Bengali](https:\/\/www.codechef.com\/download\/translated\/JULY21\/bengali\/LADCOMP.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/JULY21\/mandarin\/LADCOMP.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/JULY21\/russian\/LADCOMP.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/JULY21\/vietnamese\/LADCOMP.pdf) as well.\n\nMadoka was given a tree on her coming of age, and not a simple one, but a rooted tree of $n$ vertices with a root at the vertex with the number $1$.\n\nFor all $i\\ge 2$, let $P_i$ ($1 \\leq P_i \\leq i - 1$) be the parent of the vertex $i$.\n\nLet's define the depth array $h$ as follows: $h_1 = 1$, and $h_i = h_{P_i} + 1$ for all $i \\ge 2$.\n\nThe subtree of a vertex $u$, denoted $S(u)$, is defined as the set of vertices $v$ such that the unique path from $1$ to $v$ contains $u$. Also, we define $$\\mathrm{val}_u = \\max \\{h(v) : v\\in S(u)\\}.$$\n\nA tree is divided into paths by a ladder decomposition if each vertex is located on exactly one path, and each vertex $u$ with at least one child lies in the same path as its child $v$ with the maximum $\\mathrm{val}_v$, and if there are several such vertices, then the vertex with the minimum number is selected.\n\nMadoka defines the beauty of a tree in the following way. Let the ladder decomposition of the path lengths be $L_1, \\dots, L_k$, then the beauty of the tree is $L_1^2 + L_2^2 + \\cdots + L_k^2$\n\nFor each $i$ ($1\\le i\\le n$), your task is to calculate the beauty of the tree formed by the first $i$ vertices.\n\n### Input\n\n- The first line contains an integer $T$ - the number of test cases. Then $T$ test cases follow.\n- The first line of each test case contains a single integer $n$ - the size of the tree.\n- The second line contains $n-1$ integers $P_2, \\ldots, P_n$.\n\n### Output\nFor each test case, print in a separate line a single integer - the answer to the problem.\n\n### Constraints\n- $1 \\leq T \\leq 10$\n- $2 \\leq n \\leq 8 \\cdot 10^5$\n- $1\\le P_i \\lt i$ for all $2\\le i\\le n$\n- The sum of $n$ over all test cases is at most $8 \\cdot 10^5$\n\n### Subtasks\n\n- **Subtask 1 (10 points):** \n    - The sum of $n$ is at most $2\\cdot 10^3$.\n    - The time limit is $1$ second.\n- **Subtask 2 (20 points):**\n    - $h_i\\leq 3$ for all $i$.\n    - The sum of $n$ is at most $10^5$.\n    - The time limit is $1$ second.\n- **Subtask 3 (50 points):**\n    - The sum of $n$ is at most $2\\cdot 10^5$.\n    - The time limit is $1$ second.\n- **Subtask 4 (20 points):**\n    - Original constraints.\n    - The time limit is $2.2$ seconds.\n\n### Sample Input\n```\n2\n6\n1 2 1 4 3\n12\n1 2 1 4 4 6 2 8 5 6 11\n```\n\n### Sample Output\n```\n0 1 4 4 5 10\n0 1 4 4 5 5 10 10 13 14 14 21\n```\n\n### Explanation\n<img src=\"https:\/\/i.ibb.co\/VDnNs3r\/2.png\" class=\"center\" width=\"774\" height=\"713\">\n\n","inputFormat":"","inputFormatState":false,"outputFormat":"","outputFormatState":false,"sampleTestCases":[]},"video_editorial_url":"","languages_supported":"CPP14, C, JAVA, PYTH 3.6, CPP17, PYTH, PYP3, CS2, ADA, PYPY, TEXT, PAS fpc, NODEJS, RUBY, PHP, GO, HASK, TCL, PERL, SCALA, LUA, kotlin, BASH, JS, LISP sbcl, rust, PAS gpc, BF, CLOJ, R, D, CAML, FORT, ASM, swift, FS, WSPC, LISP clisp, SQL, SCM guile, PERL6, ERL, CLPS, ICK, NICE, PRLG, ICON, COB, SCM chicken, PIKE, SCM qobi, ST, SQLQ, NEM","max_timelimit":"1 - 2.2","source_sizelimit":"50000","problem_author":"fairy_winx","problem_author_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #FFBF00;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>5&#9733;<\/span><span class='m-username--link'>fairy_winx<\/span>","problem_tester":"","problem_tester_html_handle":"","date_added":"28-06-2021","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/eulerian-tour'>eulerian-tour<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/fairy_winx'>fairy_winx<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/july21'>july21<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/medium'>medium<\/a>","problem_difficulty_level":"Medium","user_zen_mode":false,"best_tag":"Eulerian Tour","editorial_url":"https:\/\/discuss.codechef.com\/problems\/LADCOMP","time":{"view_start_date":1626082200,"submit_start_date":1626082200,"visible_start_date":1626082200,"end_date":1735669800,"current":1643797953},"user":{"username":null,"access":"default"},"todo":false,"problem_status":"unattempted","is_direct_submittable":false,"problemDiscussURL":"https:\/\/discuss.codechef.com\/search?q=LADCOMP","is_proctored":false,"is_user_verified_for_proctoring":null,"visitedContests":[]}