{"category_name":"medium","status":"success","problem_code":"MATPERM","problem_name":"Matrix Permutations","body":"### Read problem statements in [Mandarin](https:\/\/www.codechef.com\/download\/translated\/LTIME98\/mandarin\/MATPERM.pdf), [Bengali](https:\/\/www.codechef.com\/download\/translated\/LTIME98\/bengali\/MATPERM.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/LTIME98\/russian\/MATPERM.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/LTIME98\/vietnamese\/MATPERM.pdf) as well.\n\nThere is a grid with $N$ rows and $M$ columns. There are $K$ cannons (numbered $1$ through $K$) placed in $K$ cells of this grid. Each cannon can fire a ball to any cell whose Manhattan distance from the cannon does not exceed the strength of the cannon (including the cell with the cannon). Initially (at the $0$-th second), the strengths of all the cannons are $0$ and they increase by $1$ every second. Starting at the $0$-th second, cannons start throwing balls according to the following rules: \n\n- At each second, exactly one cannon fires one ball to a cell which does not contain any balls yet. (Note that at least one such cell exists for each cannon unless the grid is full.)\n- The same cannon may fire during multiple seconds.\n- When a ball is fired by a cannon at the $i$-th second, the number $i$ gets printed on the cell the ball lands in.\n\nAt the end of the $N \\cdot M - 1$ th second, the grid will be representing a permutation of the integers $0$ through $N \\cdot M - 1$. (Two permutations $P_1$ and $P_2$ are different if at least one cell has different numbers printed on it in $P_1$ and $P_2$.)\n\nA permutation is considered to be *good* if it can be formed at the end of the $N \\cdot M - 1$ \nth second in the given process.\n\nYour task is to find the fraction of permutations that are good, i.e. the number of good permutations divided by the number of all permutations of $0$ through $N \\cdot M - 1$. Let's denote this fraction by $P\/Q$, where $P$ and $Q$ are positive integers and $Q$ is coprime with $2,500,000,001$. You should compute $P \\cdot Q^{-1}$ modulo $2,500,000,001$, where $Q^{-1}$ denotes the multiplicative inverse of $Q$ modulo $2,500,000,001$.\n\n**Note:** The Manhattan distance between a cell in row $r_1$ and column $c_1$ and a cell in row $r_2$ and column $c_2$ is $|r_1-r_2| + |c_1-c_2|$.\n\n<aside style='background: #f8f8f8;padding: 10px 15px;'><div>All submissions for this problem are available.<\/div><\/aside>","problemComponents":{"constraints":"- $1 \\leq T \\leq 1,000$\n- $1 \\leq N,M \\leq 50,000$\n- $1 \\leq K \\leq \\min(N \\cdot M, 1,000)$\n- $1 \\leq R_i \\leq N$ for each valid $i$\n- $1 \\leq C_i \\leq M$ for each valid $i$\n- the sum of $K$ over all test cases does not exceed $1,000$\n- the sum of $N$ over all test cases does not exceed $10^7$\n- the sum of $M$ over all test cases does not exceed $10^7$\n","constraintsState":true,"subtasks":"**Subtask #1 (30 points):** \n- $1 \\leq N \\cdot M \\leq 10^6$\n- The sum of $ N \\cdot M$ over all test cases does not exceed $10^6$\n\n**Subtask #2 (70 points):** original constraints\n","subtasksState":true,"statement":"### Read problem statements in [Mandarin](https:\/\/www.codechef.com\/download\/translated\/LTIME98\/mandarin\/MATPERM.pdf), [Bengali](https:\/\/www.codechef.com\/download\/translated\/LTIME98\/bengali\/MATPERM.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/LTIME98\/russian\/MATPERM.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/LTIME98\/vietnamese\/MATPERM.pdf) as well.\n\nThere is a grid with $N$ rows and $M$ columns. There are $K$ cannons (numbered $1$ through $K$) placed in $K$ cells of this grid. Each cannon can fire a ball to any cell whose Manhattan distance from the cannon does not exceed the strength of the cannon (including the cell with the cannon). Initially (at the $0$-th second), the strengths of all the cannons are $0$ and they increase by $1$ every second. Starting at the $0$-th second, cannons start throwing balls according to the following rules: \n\n- At each second, exactly one cannon fires one ball to a cell which does not contain any balls yet. (Note that at least one such cell exists for each cannon unless the grid is full.)\n- The same cannon may fire during multiple seconds.\n- When a ball is fired by a cannon at the $i$-th second, the number $i$ gets printed on the cell the ball lands in.\n\nAt the end of the $N \\cdot M - 1$ th second, the grid will be representing a permutation of the integers $0$ through $N \\cdot M - 1$. (Two permutations $P_1$ and $P_2$ are different if at least one cell has different numbers printed on it in $P_1$ and $P_2$.)\n\nA permutation is considered to be *good* if it can be formed at the end of the $N \\cdot M - 1$ \nth second in the given process.\n\nYour task is to find the fraction of permutations that are good, i.e. the number of good permutations divided by the number of all permutations of $0$ through $N \\cdot M - 1$. Let's denote this fraction by $P\/Q$, where $P$ and $Q$ are positive integers and $Q$ is coprime with $2,500,000,001$. You should compute $P \\cdot Q^{-1}$ modulo $2,500,000,001$, where $Q^{-1}$ denotes the multiplicative inverse of $Q$ modulo $2,500,000,001$.\n\n**Note:** The Manhattan distance between a cell in row $r_1$ and column $c_1$ and a cell in row $r_2$ and column $c_2$ is $|r_1-r_2| + |c_1-c_2|$.\n","inputFormat":"- The first line of the input contains a single integer $T$ denoting the number of test cases. The description of $T$ test cases follows.\n- The first line of each test case contains three space-separated integers $N$, $M$ and $K$.\n- $K$ lines follow. For each valid $i$, the $i$-th of these lines contains two space-separated integers $R_i$ and $C_i$ \u2014 the row and column where the $i$-th cannon is located.\n","inputFormatState":true,"outputFormat":"For each test case, print a single line containing one integer $P \\cdot Q^{-1}$ modulo $2,500,000,001$.\n","outputFormatState":true,"sampleTestCases":[{"id":"1","input":"3\n2 2 2\n1 1\n2 2\n2 2 4\n1 1\n1 2\n2 1\n2 2\n1 2 1\n1 1","output":"1250000001\n1\n1250000001\n","explanation":"","isDeleted":false}]},"video_editorial_url":"","languages_supported":"CPP14, C, JAVA, PYTH 3.6, CPP17, PYTH, PYP3, CS2, ADA, PYPY, TEXT, PAS fpc, NODEJS, RUBY, PHP, GO, HASK, TCL, PERL, SCALA, LUA, kotlin, BASH, JS, LISP sbcl, rust, PAS gpc, BF, CLOJ, R, D, CAML, FORT, ASM, swift, FS, WSPC, LISP clisp, SQL, SCM guile, PERL6, ERL, CLPS, ICK, NICE, PRLG, ICON, COB, SCM chicken, PIKE, SCM qobi, ST, SQLQ, NEM","max_timelimit":"1","source_sizelimit":"50000","problem_author":"vanshkaul","problem_author_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #684273;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>4&#9733;<\/span><span class='m-username--link'>vanshkaul<\/span>","problem_tester":"","problem_tester_html_handle":"","date_added":"29-07-2021","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/ltime98'>ltime98<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/medium-hard'>medium-hard<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/vanshkaul'>vanshkaul<\/a>","problem_difficulty_level":"Medium-Hard","user_zen_mode":false,"best_tag":"Medium Hard","editorial_url":"https:\/\/discuss.codechef.com\/problems\/MATPERM","time":{"view_start_date":1627745402,"submit_start_date":1627745402,"visible_start_date":1627745402,"end_date":1735669800,"current":1643797956},"user":{"username":null,"access":"default"},"todo":false,"problem_status":"unattempted","is_direct_submittable":false,"problemDiscussURL":"https:\/\/discuss.codechef.com\/search?q=MATPERM","is_proctored":false,"is_user_verified_for_proctoring":null,"visitedContests":[]}