{"category_name":"medium","status":"success","problem_code":"UWCOI21E","problem_name":"City Mapping 2","body":"Salmon is going on holiday, and he decides to go to Silvermill after taking the advice of his good friend Peanut. Unfortunately, his computer is broken, and so he cannot Google for the map.\r\n\r\nSilvermill is a city consisting of $N$ road junctions, numbered from $1$ to $N$, and $N-1$ roads. The city is fully connected, meaning it is possible to travel from every road junction to every other road junction using the roads in the city. The government building is also at one road junction, which is considered a special road junction. Hence, the road network forms a rooted tree with nodes are road junctions and edges as roads. In addition, there are **no more than three roads connected to each junction** in the city.\r\n\r\nSalmon needs to obtain a map of Silvermill. It suffices to find the parent of each node in the tree. If the node is the root, then its parent is -1.\r\n\r\nTo find the map of the city, he has hired a cartographer who can answer the following question: \u201cwhat is the lowest common ancestor of nodes $X$ and $Y$?\u201d The cartographer answers this question at most $Q$ times before quitting his job.\r\n\r\nHelp Salmon! Using at most $Q$ queries to the lowest common ancestor of two nodes, recover the tree!\r\n\r\n### Interaction format\r\n\r\n- The first line of input will contain $T$, number of testcases. Then the testcases follow.\r\n\r\n- For each testcase, the input contains one line containing $N$, the number of nodes in the tree, and $Q$, the maximum number of queries you are allowed to ask.\r\n\r\n- To query the lowest common ancestor of a pair of nodes $(x,y)$, output ? x y. This uses up one query. If either of the two nodes is out of the range $[1, N]$ or you have exceeded the query limit $Q$, the judge replies -1 exiting with a wrong answer verdict and you should terminate your program immediately. Otherwise, the judge outputs the LCA of the two nodes.\r\n\r\n- When you have the answer, output !  followed by $N$ space-separated integers. The $i$-th integer should be the parent of node $i$ in the tree (-1 if $i$ is the root). Note that this is not counted as a query. If the parent values are correct, the judge outputs a single integer, $1$ and you should process the next testcase(if any). Otherwise, the judge outputs $-1$ and returns with a wrong answer verdict. In this case, you should terminate your program immediately.\r\n\r\n### Constraints\r\n\r\n- $T = 5$\r\n- $1 \\leq N \\leq 1000$\r\n- $1 \\leq Q \\leq 25000$\r\n- For each query, the two nodes you query should be in the range $[1,N]$.\r\n- For each answer, all the parent values should be in the range $[1,N]$ or equal to -1.\r\n- There are at most three roads connected to each junction.\r\n- The grader is not adaptive.\r\n\r\n### Subtasks\r\n- Subtask 1 [15 points] : $1 \\leq N \\leq 100, Q = 5000$\r\n- Subtask 2 [25 points]: $Q = 25000$. Each junction has at most **two** roads connected to it.\r\n- Subtask 3 [60 points]: $Q = 25000$.\r\n\r\n### Sample Interaction:\r\n\r\nBelow is an example in which there are two testcases both with $N = 3$. In the first testcase, node $1$ is the root and nodes $2$  and $3$ are its children. In the second testcase, node $2$ is the root. The parent of node $1$ is node $2$ and that of node $3$ is node $1$.\r\n\r\n```\r\nYou             Judge\r\n                2          \/\/ T\r\n                3 4        \/\/  N, Q for the first testcase\r\n? 1 2\r\n                1          \/\/ LCA(1, 2) = 1\r\n? 2 3\r\n                1          \/\/ LCA(2, 3) = 1\r\n! -1 1 1\r\n                1          \/\/ Judge replies that your answer\r\n                           \/\/ is correct\r\n                \r\n                3 3        \/\/  N, Q for the second testcase\r\n? 1 2\r\n                2          \/\/ LCA(1, 2) = 2\r\n? 2 3\r\n                2          \/\/ LCA(2, 3) = 2\r\n? 3 1\r\n                1          \/\/ LCA(3, 1) = 1\r\n! 2 -1 1\r\n                1          \/\/ Judge replies that your answer\r\n                           \/\/ is correct\r\n```\n<aside style='background: #f8f8f8;padding: 10px 15px;'><div>All submissions for this problem are available.<\/div><\/aside>","problemComponents":{"constraints":"","constraintsState":false,"subtasks":"","subtasksState":false,"statement":"Salmon is going on holiday, and he decides to go to Silvermill after taking the advice of his good friend Peanut. Unfortunately, his computer is broken, and so he cannot Google for the map.\r\n\r\nSilvermill is a city consisting of $N$ road junctions, numbered from $1$ to $N$, and $N-1$ roads. The city is fully connected, meaning it is possible to travel from every road junction to every other road junction using the roads in the city. The government building is also at one road junction, which is considered a special road junction. Hence, the road network forms a rooted tree with nodes are road junctions and edges as roads. In addition, there are **no more than three roads connected to each junction** in the city.\r\n\r\nSalmon needs to obtain a map of Silvermill. It suffices to find the parent of each node in the tree. If the node is the root, then its parent is -1.\r\n\r\nTo find the map of the city, he has hired a cartographer who can answer the following question: \u201cwhat is the lowest common ancestor of nodes $X$ and $Y$?\u201d The cartographer answers this question at most $Q$ times before quitting his job.\r\n\r\nHelp Salmon! Using at most $Q$ queries to the lowest common ancestor of two nodes, recover the tree!\r\n\r\n### Interaction format\r\n\r\n- The first line of input will contain $T$, number of testcases. Then the testcases follow.\r\n\r\n- For each testcase, the input contains one line containing $N$, the number of nodes in the tree, and $Q$, the maximum number of queries you are allowed to ask.\r\n\r\n- To query the lowest common ancestor of a pair of nodes $(x,y)$, output ? x y. This uses up one query. If either of the two nodes is out of the range $[1, N]$ or you have exceeded the query limit $Q$, the judge replies -1 exiting with a wrong answer verdict and you should terminate your program immediately. Otherwise, the judge outputs the LCA of the two nodes.\r\n\r\n- When you have the answer, output !  followed by $N$ space-separated integers. The $i$-th integer should be the parent of node $i$ in the tree (-1 if $i$ is the root). Note that this is not counted as a query. If the parent values are correct, the judge outputs a single integer, $1$ and you should process the next testcase(if any). Otherwise, the judge outputs $-1$ and returns with a wrong answer verdict. In this case, you should terminate your program immediately.\r\n\r\n### Constraints\r\n\r\n- $T = 5$\r\n- $1 \\leq N \\leq 1000$\r\n- $1 \\leq Q \\leq 25000$\r\n- For each query, the two nodes you query should be in the range $[1,N]$.\r\n- For each answer, all the parent values should be in the range $[1,N]$ or equal to -1.\r\n- There are at most three roads connected to each junction.\r\n- The grader is not adaptive.\r\n\r\n### Subtasks\r\n- Subtask 1 [15 points] : $1 \\leq N \\leq 100, Q = 5000$\r\n- Subtask 2 [25 points]: $Q = 25000$. Each junction has at most **two** roads connected to it.\r\n- Subtask 3 [60 points]: $Q = 25000$.\r\n\r\n### Sample Interaction:\r\n\r\nBelow is an example in which there are two testcases both with $N = 3$. In the first testcase, node $1$ is the root and nodes $2$  and $3$ are its children. In the second testcase, node $2$ is the root. The parent of node $1$ is node $2$ and that of node $3$ is node $1$.\r\n\r\n```\r\nYou             Judge\r\n                2          \/\/ T\r\n                3 4        \/\/  N, Q for the first testcase\r\n? 1 2\r\n                1          \/\/ LCA(1, 2) = 1\r\n? 2 3\r\n                1          \/\/ LCA(2, 3) = 1\r\n! -1 1 1\r\n                1          \/\/ Judge replies that your answer\r\n                           \/\/ is correct\r\n                \r\n                3 3        \/\/  N, Q for the second testcase\r\n? 1 2\r\n                2          \/\/ LCA(1, 2) = 2\r\n? 2 3\r\n                2          \/\/ LCA(2, 3) = 2\r\n? 3 1\r\n                1          \/\/ LCA(3, 1) = 1\r\n! 2 -1 1\r\n                1          \/\/ Judge replies that your answer\r\n                           \/\/ is correct\r\n```","inputFormat":"","inputFormatState":false,"outputFormat":"","outputFormatState":false,"sampleTestCases":[]},"video_editorial_url":"","languages_supported":"CPP14, C, JAVA, PYTH 3.6, CPP17, PYTH, PYP3, CS2, ADA, PYPY, TEXT, PAS fpc, NODEJS, RUBY, PHP, GO, HASK, TCL, PERL, SCALA, LUA, kotlin, BASH, JS, LISP sbcl, rust, PAS gpc, BF, CLOJ, R, D, CAML, FORT, ASM, swift, FS, WSPC, LISP clisp, SQL, SCM guile, PERL6, ERL, CLPS, ICK, NICE, PRLG, ICON, COB, SCM chicken, PIKE, SCM qobi, ST, SQLQ, NEM","max_timelimit":"1","source_sizelimit":"50000","problem_author":"kimbj0709","problem_author_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #3366CC;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>3&#9733;<\/span><span class='m-username--link'>kimbj0709<\/span>","problem_tester":"","problem_tester_html_handle":"","date_added":"12-12-2020","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/kimbj0709'>kimbj0709<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/medium'>medium<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/uwcoi21'>uwcoi21<\/a>","problem_difficulty_level":"Medium","user_zen_mode":false,"best_tag":"","editorial_url":"https:\/\/discuss.codechef.com\/problems\/UWCOI21E","time":{"view_start_date":1104528600,"submit_start_date":1104528600,"visible_start_date":1104528600,"end_date":1735669800,"current":1643797988},"user":{"username":null,"access":"default"},"todo":false,"problem_status":"unattempted","is_direct_submittable":false,"problemDiscussURL":"https:\/\/discuss.codechef.com\/search?q=UWCOI21E","is_proctored":false,"is_user_verified_for_proctoring":null,"visitedContests":[]}