{"category_name":"medium","status":"success","problem_code":"PERSHFTS","problem_name":"Cyclic shifts in permutation","body":"<span class=\"solution-visible-txt\">All submissions for this problem are available.<\/span><h3> Read problems statements in <a target=\"_blank\" href=\"http:\/\/www.codechef.com\/download\/translated\/OCT15\/mandarin\/PERSHFTS.pdf\">Mandarin Chinese <\/a> and <a target=\"_blank\" href=\"http:\/\/www.codechef.com\/download\/translated\/OCT15\/russian\/PERSHFTS.pdf\">Russian<\/a> <\/h3>\n<p>You have a permutation <b>P<\/b> of integers <b>1<\/b>, <b>2<\/b>, ... , <b>N<\/b>. You want to change it a little. To do this, you choose an integer <b>K<\/b> that satisfies an inequality <b>2<\/b> \u2264 <b>K<\/b> \u2264 <b>N<\/b>. After that, you perform several (possibly, zero, if you're feeling lazy) cyclic shifts. For each cyclic shift you choose a <b>K<\/b>-length segment of the permutation <b>P<\/b> (let's denote it as <b>P<sub>x<\/sub><\/b>, <b>P<sub>x + 1<\/sub><\/b>, ..., <b>P<sub>x + K - 2<\/sub><\/b>, <b>P<sub>x + K - 1<\/sub><\/b>) and perform a cyclic shift on it towards the right. That is, rearrange elements of this segment in the order <b>P<sub>x + K - 1<\/sub><\/b>, <b>P<sub>x<\/sub><\/b>, ... , <b>P<sub>x + K - 3<\/sub><\/b>, <b>P<sub>x + K - 2<\/sub><\/b>.<\/p>\n<p>For example, let's make a permutation <b>(6, 5, 1, 3, 2, 4)<\/b> from permutation <b>(1, 5, 4, 6, 3, 2)<\/b>, using <b>K = 4<\/b>. Segments that are cyclically shifted on every move are underlined: <b>(<u>1, 5, 4, 6<\/u>, 3, 2)<\/b> => <b>(6, 1, <u>5, 4, 3, 2<\/u>)<\/b>=> <b>(6, 1, <u>2, 5, 4, 3<\/u>)<\/b> => <b>(6, <u>1, 3, 2, 5<\/u>, 4)<\/b> => <b>(6, 5, 1, 3, 2, 4)<\/b>.<\/p>\n<p>Let <b>S<\/b> denote the set of permutations that can be obtained from permutation <b>P<\/b> using zero or more cyclic shifts. You are given a permutation <b>Q<\/b> of integers <b>1<\/b>, <b>2<\/b>, ..., <b>N<\/b>. Your task is to find whether <b>S<\/b> contains <b>Q<\/b> or not. If so, also you must find the index of <b>Q<\/b> in the list of all permutations in set <b>S<\/b>, ordered lexicographically.<\/p>\n<h3>Input<\/h3>\n<p>The first line of the input contains an integer <b>T<\/b> denoting the number of test cases. The  description of <b>T<\/b> test cases follows.<\/p>\n<p>The first line of each test case contains two integers <b>N<\/b> and <b>K<\/b> denoting the length of the permutations <b>P<\/b> and <b>Q<\/b>, and length of the segments that you are allowed to cyclically shift.<\/p>\n<p>Next line contains <b>N<\/b> integers <b>P<sub>1<\/sub><\/b>, <b>P<sub>2<\/sub><\/b>, ..., <b>P<sub>N<\/sub><\/b> denoting the permutation <b>P<\/b>.<\/p>\n<p>Next line contains <b>N<\/b> integers <b>Q<sub>1<\/sub><\/b>, <b>Q<sub>2<\/sub><\/b>, ..., <b>Q<sub>N<\/sub><\/b> denoting the permutation <b>Q<\/b>.<\/p>\n<h3>Output<\/h3>\n<p>For each test case, output a single line. It must contain <b>-1<\/b>, if permutation <b>Q<\/b> can't be obtained from permutation <b>P<\/b> using allowed cyclic shifts. Otherwise, print its 1-based index in the list of all permutations from set <b>S<\/b>, ordered lexicographically. Since the answer can be very large, print it modulo <b>10<sup>9<\/sup> + 7<\/b>.<\/p>\n<h3>Constraints<\/h3>\n<ul>\n<li><b>2<\/b> \u2264 <b>N<\/b> \u2264 <b>10<sup>5<\/sup><\/b><\/li>\n<li><b>2<\/b> \u2264 <b>K<\/b> \u2264 <b>N<\/b><\/li>\n<li><b>P<sub>1<\/sub><\/b>, <b>P<sub>2<\/sub><\/b>, ..., <b>P<sub>N<\/sub><\/b> are forming a permutation of integers from <b>1<\/b> to <b>N<\/b><\/li>\n<li><b>Q<sub>1<\/sub><\/b>, <b>Q<sub>2<\/sub><\/b>, ..., <b>Q<sub>N<\/sub><\/b> are forming a permutation of integers from <b>1<\/b> to <b>N<\/b><\/li>\n<\/ul>\n<h3>Subtasks<\/h3>\n<p><b>Subtask 1: (10 points)<\/b><\/p>\n<ul>\n<li><b>1<\/b> \u2264 <b>T<\/b> \u2264 <b>1000<\/b><\/li>\n<li><b>2<\/b> \u2264 <b>N<\/b> \u2264 <b>5<\/b><\/li>\n<\/ul>\n\n<p><b>Subtask 2: (10 points)<\/b><\/p>\n<ul>\n<li><b>1<\/b> \u2264 <b>T<\/b> \u2264 <b>10<\/b><\/li>\n<li><b>2<\/b> \u2264 <b>N<\/b> \u2264 <b>10<sup>5<\/sup><\/b><\/li>\n<li><b>K<\/b> = <b>N<\/b><\/li>\n<\/ul>\n\n<p><b>Subtask 3: (40 points)<\/b><\/p>\n<ul>\n<li><b>1<\/b> \u2264 <b>T<\/b> \u2264 <b>10<\/b><\/li>\n<li><b>2<\/b> \u2264 <b>N<\/b> \u2264 <b>1000<\/b><\/li>\n<\/ul>\n\n<p><b>Subtask 4: (40 points)<\/b><\/p>\n<ul>\n<li><b>1<\/b> \u2264 <b>T<\/b> \u2264 <b>10<\/b><\/li>\n<li>Original constraints<\/li>\n<\/ul>\n<h3>Example<\/h3>\n<pre><b>Input:<\/b>\n<tt>2\n4 2\n2 4 3 1\n1 2 4 3\n3 3\n1 2 3\n1 3 2<\/tt>\n\n<b>Output:<\/b>\n<tt>2\n-1<\/tt>\n<\/pre><h3>Explanation<\/h3>\n<p><b>Example case 1.<\/b> Cyclic shift of segment of length <b>2<\/b> is swapping consecutive elements of the permutation. Using them, we are able to get any possible permutation. Permutation <b>Q<\/b> has index <b>2<\/b> in the list of all permutations of length <b>4<\/b>.<\/p>\n<p><b>Example case 2.<\/b> We are able to get permutations <b>(1, 2, 3)<\/b>, <b>(2, 3, 1)<\/b> and <b>(3, 1, 2)<\/b>. Permutation <b>Q<\/b> doesn't belong to this list, so answer is <b>-1<\/b>.<\/p>\n","languages_supported":"ADA, ASM, BASH, BF, C, C99 strict, CAML, CLOJ, CLPS, CPP 4.3.2, CPP 4.9.2, CPP14, CS2, D, ERL, FORT, FS, GO, HASK, ICK, ICON, JAVA, JS, LISP clisp, LISP sbcl, LUA, NEM, NICE, NODEJS, PAS fpc, PAS gpc, PERL, PERL6, PHP, PIKE, PRLG, PYPY, PYTH, PYTH 3.4, RUBY, SCALA, SCM chicken, SCM guile, SCM qobi, ST, TCL, TEXT, WSPC","max_timelimit":"1","source_sizelimit":"50000","problem_author":"eartemov","problem_author_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #FFBF00;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>5&#9733;<\/span><span>eartemov<\/span>","problem_tester":null,"problem_tester_html_handle":"","date_added":"4-08-2015","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/eartemov'>\n                    eartemov\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/fenwick-tree'>\n                    fenwick-tree\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/inversions'>\n                    inversions\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/maths'>\n                    maths\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/medium'>\n                    medium\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/oct15'>\n                    oct15\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/permutation'>\n                    permutation\n                <\/a>","editorial_url":"http:\/\/discuss.codechef.com\/problems\/PERSHFTS","user":{"username":null},"time":{"view_start_date":1444642200,"submit_start_date":1444642200,"visible_start_date":1444642200,"end_date":1735669800,"current":1493557852},"todo":false,"problem_status":"unattempted"}