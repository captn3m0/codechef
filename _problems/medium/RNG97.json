{"category_name":"medium","status":"success","problem_code":"RNG97","problem_name":"Random Number Generator","body":"### Read problem statements in [Hindi](https:\/\/www.codechef.com\/download\/translated\/LTIME77\/hindi\/RNG97.pdf), [Bengali](https:\/\/www.codechef.com\/download\/translated\/LTIME77\/bengali\/RNG97.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/LTIME77\/mandarin\/RNG97.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/LTIME77\/russian\/RNG97.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/LTIME77\/vietnamese\/RNG97.pdf) as well.\n\nAlmir has a multiset $S = \\{s_1, s_2, \\ldots, s_N\\}$; recall that a multiset may contain duplicate elements. At the time $t = 0$, Almir starts his random number generator and feeds his multiset to it. During each subsequent second, the random number generator would transform the multiset in the following manner:\n- for each valid $t$, let $S_{t-1}$ be the multiset at the beginning of the $t$-th second ($S_0 = S$)\n- for each element $x \\in S_{t-1}$, during the $t$-th second, $x$ is transformed into $x^{random(1, K)} \\, \\% \\, M$, where $random(1, K)$ denotes a uniformly randomly generated integer between $1$ and $K$ inclusive\n- at the end of the $t$-th second, $S_t$ is the multiset of these transformed elements\n\nIn addition, Almir can insert elements into the multiset at the end of some seconds (i.e. immediately after some transformation has finished). You should answer $Q$ queries of two types:\n- `1 t x`: find the expected number of elements of the multiset at the end of the $t$-th second (the multiset $S_t$) that are equal to $x$\n- `2 t x`: insert a new element $x$ into the multiset at the end of the $t$-th second (the multiset $S_t$)\n\nNote that the queries are given in chronological order and there are no overlaps between any queries or transformations.\n\nYour task is to find the answers to all queries of the first type. It can be shown that in each of these queries, the expected value can be expressed as an irreducible fraction $\\frac{P}{Q}$, where $P$ and $Q$ are non-negative integers and $Q$ is coprime to $10^9+7$. You should find $P \\cdot Q^{-1}$ modulo $10^9+7$, where $Q^{-1}$ denotes the multiplicative inverse of $Q$ modulo $10^9+7$.\n\n### Input\n- The first line of the input contains four space-separated integers $N$, $Q$, $K$ and $M$.\n- The second line contains $N$ space-separated integers $s_1, s_2, \\ldots, s_N$.\n- The following $Q$ lines describe queries. For each valid $i$, the $i$-th of these lines contains three space-separated numbers $type_i$, $t_i$ and $x_i$ describing the $i$-th query.\n\n### Output\nFor each query of the first type, print a single line containing one integer $P \\cdot Q^{-1} \\, \\% \\, (10^9+7)$.\n\n### Constraints \n- $1 \\le N \\le 10^5$\n- $1 \\le Q \\le 10^6$\n- $1 \\le K \\le 10^9$\n- $1 \\le M \\le 100$\n- $M$ is a prime\n- $1 \\le t_1 \\lt t_2 \\lt \\ldots \\lt t_Q \\le 10^6$\n- $1 \\le s_i \\lt M$ for each valid $i$\n- $type_i \\in \\{1, 2\\}$ for each valid $i$\n- $1 \\le x_i \\lt M$ for each valid $i$\n\n### Subtasks\n**Subtask #1 (15 points):** $1 \\le Q \\le 1000$\n \n**Subtask #2 (35 points):** the only query of the first type is the last query\n \n**Subtask #3 (50 points):** original constraints\n\n### Example Input 1\n```\n4 6 10 5\n1 2 3 4\n2 10 1\n2 15 2\n2 17 4\n2 20 2\n2 30 3\n1 40 4\n```\n\n### Example Output 1\n```\n645425103\n```\n\n### Example Input 2\n```\n4 6 10 5\n1 2 3 4\n2 10 1\n1 15 2\n2 17 4\n1 20 2\n2 30 3\n1 40 4\n```\n\n### Example Output 2\n```\n970977790\n467843059\n655757002\n```\n\n<aside style='background: #f8f8f8;padding: 10px 15px;'><div>All submissions for this problem are available.<\/div><\/aside>","problemComponents":{"constraints":"","constraintsState":false,"subtasks":"","subtasksState":false,"statement":"### Read problem statements in [Hindi](https:\/\/www.codechef.com\/download\/translated\/LTIME77\/hindi\/RNG97.pdf), [Bengali](https:\/\/www.codechef.com\/download\/translated\/LTIME77\/bengali\/RNG97.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/LTIME77\/mandarin\/RNG97.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/LTIME77\/russian\/RNG97.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/LTIME77\/vietnamese\/RNG97.pdf) as well.\n\nAlmir has a multiset $S = \\{s_1, s_2, \\ldots, s_N\\}$; recall that a multiset may contain duplicate elements. At the time $t = 0$, Almir starts his random number generator and feeds his multiset to it. During each subsequent second, the random number generator would transform the multiset in the following manner:\n- for each valid $t$, let $S_{t-1}$ be the multiset at the beginning of the $t$-th second ($S_0 = S$)\n- for each element $x \\in S_{t-1}$, during the $t$-th second, $x$ is transformed into $x^{random(1, K)} \\, \\% \\, M$, where $random(1, K)$ denotes a uniformly randomly generated integer between $1$ and $K$ inclusive\n- at the end of the $t$-th second, $S_t$ is the multiset of these transformed elements\n\nIn addition, Almir can insert elements into the multiset at the end of some seconds (i.e. immediately after some transformation has finished). You should answer $Q$ queries of two types:\n- `1 t x`: find the expected number of elements of the multiset at the end of the $t$-th second (the multiset $S_t$) that are equal to $x$\n- `2 t x`: insert a new element $x$ into the multiset at the end of the $t$-th second (the multiset $S_t$)\n\nNote that the queries are given in chronological order and there are no overlaps between any queries or transformations.\n\nYour task is to find the answers to all queries of the first type. It can be shown that in each of these queries, the expected value can be expressed as an irreducible fraction $\\frac{P}{Q}$, where $P$ and $Q$ are non-negative integers and $Q$ is coprime to $10^9+7$. You should find $P \\cdot Q^{-1}$ modulo $10^9+7$, where $Q^{-1}$ denotes the multiplicative inverse of $Q$ modulo $10^9+7$.\n\n### Input\n- The first line of the input contains four space-separated integers $N$, $Q$, $K$ and $M$.\n- The second line contains $N$ space-separated integers $s_1, s_2, \\ldots, s_N$.\n- The following $Q$ lines describe queries. For each valid $i$, the $i$-th of these lines contains three space-separated numbers $type_i$, $t_i$ and $x_i$ describing the $i$-th query.\n\n### Output\nFor each query of the first type, print a single line containing one integer $P \\cdot Q^{-1} \\, \\% \\, (10^9+7)$.\n\n### Constraints \n- $1 \\le N \\le 10^5$\n- $1 \\le Q \\le 10^6$\n- $1 \\le K \\le 10^9$\n- $1 \\le M \\le 100$\n- $M$ is a prime\n- $1 \\le t_1 \\lt t_2 \\lt \\ldots \\lt t_Q \\le 10^6$\n- $1 \\le s_i \\lt M$ for each valid $i$\n- $type_i \\in \\{1, 2\\}$ for each valid $i$\n- $1 \\le x_i \\lt M$ for each valid $i$\n\n### Subtasks\n**Subtask #1 (15 points):** $1 \\le Q \\le 1000$\n \n**Subtask #2 (35 points):** the only query of the first type is the last query\n \n**Subtask #3 (50 points):** original constraints\n\n### Example Input 1\n```\n4 6 10 5\n1 2 3 4\n2 10 1\n2 15 2\n2 17 4\n2 20 2\n2 30 3\n1 40 4\n```\n\n### Example Output 1\n```\n645425103\n```\n\n### Example Input 2\n```\n4 6 10 5\n1 2 3 4\n2 10 1\n1 15 2\n2 17 4\n1 20 2\n2 30 3\n1 40 4\n```\n\n### Example Output 2\n```\n970977790\n467843059\n655757002\n```\n","inputFormat":"","inputFormatState":false,"outputFormat":"","outputFormatState":false,"sampleTestCases":[]},"video_editorial_url":"","languages_supported":"CPP14, C, JAVA, PYTH 3.6, PYTH, PYP3, CS2, ADA, PYPY, TEXT, PAS fpc, NODEJS, RUBY, PHP, GO, HASK, TCL, PERL, SCALA, LUA, kotlin, BASH, JS, LISP sbcl, rust, PAS gpc, BF, CLOJ, R, D, CAML, FORT, ASM, swift, FS, WSPC, LISP clisp, SQL, SCM guile, PERL6, ERL, CLPS, ICK, NICE, PRLG, ICON, COB, SCM chicken, PIKE, SCM qobi, ST, NEM","max_timelimit":"4","source_sizelimit":"50000","problem_author":"jafarbadour","problem_author_html_handle":"jafarbadour","problem_tester":null,"problem_tester_html_handle":"","date_added":"24-10-2019","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/expected-value'>expected-value<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/jafarbadour'>jafarbadour<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/jafarbadour'>jafarbadour<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/ltime77'>ltime77<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/probability'>probability<\/a>","problem_difficulty_level":"Medium","user_zen_mode":false,"best_tag":"Expected Value","editorial_url":"https:\/\/discuss.codechef.com\/problems\/RNG97","time":{"view_start_date":1572111000,"submit_start_date":1572111000,"visible_start_date":1572111000,"end_date":1735669800,"current":1643797973},"user":{"username":null,"access":"default"},"todo":false,"problem_status":"unattempted","is_direct_submittable":false,"problemDiscussURL":"https:\/\/discuss.codechef.com\/search?q=RNG97","is_proctored":false,"is_user_verified_for_proctoring":null,"visitedContests":[]}