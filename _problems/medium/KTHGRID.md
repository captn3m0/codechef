---
{"category_name":"medium","problem_code":"KTHGRID","problem_name":"K-th Element on Grid","problemComponents":{"constraints":"- $1 \\le N \\le 5000$\n- $1 \\le Q \\le 5000$\n- $1 \\le seed \\le 10^{18}$\n- $1 \\le minR \\le maxR \\le N$\n- $1 \\le minC \\le maxC \\le N$\n\n**Important note about generator input and constraints for subtasks:**  \nNone of the intended solutions for any subtasks uses input format (pseudorandomness) to get better complexity. They can have slightly (less than an order of magnitude) better constant factor due to the input format, and **TL/limitations are set based on the runtime of our solutions on the generated tests**.  \nML on CodeChef is 1.5 GB. TL in this problem is 8 seconds. For any of the first 4 subtasks and any solution that is *intended* to pass it, the following holds:  \nThere exists an implementation of this solution in C++ that uses less than 1 GB of memory and less than 5 seconds per test on those subtasks.  \nThe last two subtasks are added for fun of top contestants :)\n\n**To get your verdict faster and not kill our servers it is highly recommended not to execute your program on tests from subtasks you are not even dreaming to pass.** If you are just trying to get those juicy 20 extra points from subtask 3, please put `assert(N \u003C= 2500)` after reading input.","constraintsState":true,"subtasks":"- **Subtask 1 (5 points)**: $N \\le 500$, $Q \\le 5000$\n- **Subtask 2 (30 points)**: $N \\le 1500$, $Q \\le 5000$\n- **Subtask 3 (20 points)**: $N \\le 2500$, $Q \\le 4000$\n- **Subtask 4 (40 points)**: $N \\le 4000$, $Q \\le 4000$\n- **Subtask 5 (3 points)**: $N \\le 4500$, $Q \\le 4500$\n- **Subtask 6 (2 points)**: Original constraints","subtasksState":true,"inputFormat":"The input consists of seven integers `N Q seed minR maxR minC maxC`.\n\nThe actual input to the problem will be generated using the following code (C++, use it as a reference to implement the same generator in your programming language, `uint64_t` is an unsigned 64-bit integer type):\n\n```C++\nuint64_t state;\nuint64_t nextRand() { // https://en.wikipedia.org/wiki/Xorshift\n    state ^= state \u003C\u003C 13;\n    state ^= state \u003E\u003E 7;\n    state ^= state \u003C\u003C 17;\n    return state \u003E\u003E 10;\n}\nint nextBounded(int B) {\n    return nextRand() % B;\n}\n\nint N, Q, minR, maxR, minC, maxC;\n\nvoid genGrid() {\n    vector\u003Cint\u003E p(N * N);\n    for (int i = 0; i \u003C N * N; i++)\n        p[i] = i + 1;\n    // https://en.wikipedia.org/wiki/Fisher-Yates_shuffle\n    for (int i = 0; i \u003C N * N; i++)\n        swap(p[i], p[nextBounded(i + 1)]);\n    // A_{rc} is p[(r - 1) * N + (c - 1)]\n}\n\nvoid genQuery() {\n    int lenR = minR + nextBounded(maxR - minR + 1);\n    int lenC = minC + nextBounded(maxC - minC + 1);\n    int r1 = 1 + nextBounded(N - lenR + 1);\n    int c1 = 1 + nextBounded(N - lenC + 1);\n    int r2 = r1 + lenR - 1;\n    int c2 = c1 + lenC - 1;\n    int k = 1 + nextBounded(lenR * lenC);\n    // (r1 c1 r2 c2 k) is the query described in the statement\n}\n\nint main() {\n    cin \u003E\u003E N \u003E\u003E Q \u003E\u003E state \u003E\u003E minR \u003E\u003E maxR \u003E\u003E minC \u003E\u003E maxC;\n    genGrid();\n    for (int i = 0; i \u003C Q; i++) {\n        genQuery();\n    }\n}\n```","inputFormatState":true,"outputFormat":"Print $Q$ integers - answers to queries in the order they are generated.","outputFormatState":true,"sampleTestCases":{"0":{"id":1,"input":"4 5 42 1 4 2 3\n","output":"11\n1\n5\n7\n14\n","explanation":"The actual sample input would look like this:\n```\n4 5\n8 10 2 5\n7 16 14 13\n4 15 1 11\n3 6 9 12\n1 2 3 4 5\n2 1 4 3 1\n1 3 1 4 2\n2 1 2 2 1\n1 2 4 3 6\n```","isDeleted":false}}},"video_editorial_url":"","languages_supported":{"0":"CPP14","1":"C","2":"JAVA","3":"PYTH 3.6","4":"CPP17","5":"PYTH","6":"PYP3","7":"CS2","8":"ADA","9":"PYPY","10":"TEXT","11":"PAS fpc","12":"NODEJS","13":"RUBY","14":"PHP","15":"GO","16":"HASK","17":"TCL","18":"PERL","19":"SCALA","20":"LUA","21":"kotlin","22":"BASH","23":"JS","24":"LISP sbcl","25":"rust","26":"PAS gpc","27":"BF","28":"CLOJ","29":"R","30":"D","31":"CAML","32":"FORT","33":"ASM","34":"swift","35":"FS","36":"WSPC","37":"LISP clisp","38":"SQL","39":"SCM guile","40":"PERL6","41":"ERL","42":"CLPS","43":"ICK","44":"NICE","45":"PRLG","46":"ICON","47":"COB","48":"SCM chicken","49":"PIKE","50":"SCM qobi","51":"ST","52":"SQLQ","53":"NEM"},"max_timelimit":8,"source_sizelimit":50000,"problem_author":"umnik_adm","problem_tester":"","date_added":"26-10-2021","tags":{"0":"ltime101","1":"ltime101","2":"medium","3":"medium","4":"umnik_adm"},"problem_difficulty_level":"Medium-Hard","best_tag":"Medium Hard","editorial_url":"https://discuss.codechef.com/problems/KTHGRID","time":{"view_start_date":1635354000,"submit_start_date":1635354000,"visible_start_date":1635354000,"end_date":1735669800},"is_direct_submittable":false,"problemDiscussURL":"https://discuss.codechef.com/search?q=KTHGRID","is_proctored":false,"visitedContests":{},"layout":"problem"}
---
This is an example statement in markdown. This is the statement of the problem [TANDC](https://codechef.com/problems/TANDC) on CodeChef. The main statement starts with the next paragraph. Please make sure to remove this paragraph from your statement before publishing your problem. If your problem doesn't contain Subtasks, you should remove the section subtask too. We are using markdown the syntax of which can be seen [at](https://github.com/showdownjs/showdown/wiki/Showdown's-Markdown-syntax). We request you to not use any HTML tags in the statement, e.g. no p, ul, li, pre, br or b tags. If you face any issue, please contact admins or email us at help@codechef.com.

Tracy is teaching Charlie maths via a game called $N$-Cube, which involves three sections involving $N$.

Tracy gives Charlie a number $N$, and Charlie makes a list of $N$-th powers of integers in increasing order $1^N, 2^N, 3^N, \dot, \text{so on}$. This teaches him exponentiation.

Then Charlie performs the following subtraction game $N$ times: Take all pairs of consecutive numbers in the list and take their difference. These differences then form the new list for the next iteration of the game. Eg, if $N$ was 6, the list proceeds as $[1, 64, 729, 4096 ... ]$ to $[63, 685, 3367 ...]$, and so on $5$ more times.

After the subtraction game, Charlie has to correctly tell Tracy the $N$-th element of the list. This number is the *value of the game*.

After practice Charlie became an expert in the game. To challenge him more, Tracy will give two numbers $M$ (where $M$ is a prime) and $R$ instead of just a single number $N$, and the game must start from $M_R - 1$ instead of $N$. Since the *value of the game* can now become large, Charlie just have to tell the largest integer $K$ such that $M_K$ divides this number. Since even $K$ can be large, output $K$ modulo 1000000007 ($10^9 + 7$).

<aside style='background: #f8f8f8;padding: 10px 15px;'><div>All submissions for this problem are available.</div></aside>