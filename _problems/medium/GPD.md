---
{"category_name":"medium","problem_code":"GPD","problem_name":"Gotham PD","languages_supported":{"0":"ADA","1":"ASM","2":"BASH","3":"BF","4":"C","5":"C99 strict","6":"CAML","7":"CLOJ","8":"CLPS","9":"CPP 4.3.2","10":"CPP 4.9.2","11":"CPP14","12":"CS2","13":"D","14":"ERL","15":"FORT","16":"FS","17":"GO","18":"HASK","19":"ICK","20":"ICON","21":"JAVA","22":"JS","23":"LISP clisp","24":"LISP sbcl","25":"LUA","26":"NEM","27":"NICE","28":"NODEJS","29":"PAS fpc","30":"PAS gpc","31":"PERL","32":"PERL6","33":"PHP","34":"PIKE","35":"PRLG","36":"PYPY","37":"PYTH","38":"PYTH 3.4","39":"RUBY","40":"SCALA","41":"SCM chicken","42":"SCM guile","43":"SCM qobi","44":"ST","45":"TCL","46":"TEXT","47":"WSPC"},"max_timelimit":2,"source_sizelimit":50000,"problem_author":"alexvaleanu","problem_tester":null,"date_added":"4-05-2017","tags":{"0":"alexvaleanu"},"time":{"view_start_date":1495099800,"submit_start_date":1495099800,"visible_start_date":1495099800,"end_date":1735669800},"layout":"problem"}
---
<span class="solution-visible-txt">All submissions for this problem are available.</span><h3>Read problems statements in <a target="_blank" href="http://www.codechef.com/download/translated/MAY17/mandarin/GDP.pdf">mandarin chinese</a>, <a target="_blank" href="http://www.codechef.com/download/translated/MAY17/russian/GDP.pdf">russian</a> and <a target="_blank" href="http://www.codechef.com/download/translated/MAY17/vietnamese/GDP.pdf">vietnamese</a> as well.</h3>


<p>Chef has teamed up with Batman and Jim Gordon to save Gotham from Joker's plan.<p>

<p>
There are initially <b>N</b> police stations each having a unique id and an encryption key.
All stations are connected, using telephone lines, directly or indirectly, to Gordon's police station 
(the one with id <b>R</b>).
In order to provide better protection for all people in Gotham, Batman and Chef have paid for some 
new police stations and come up a smart algorithm to test the security of a particular police station. 
</p>

<p>There are <b>Q</b> queries that the two of them perform on Gotham's infrastructure each being either an addition of a new police station or 
a security test, on a particular station, using a key generated by Chef.</p>

<p>
Your task is to help our three heroes to perform all the queries succesfully and defeat Joker.
</p>

<h3>Input</h3>
<p>There is only one test case in each test file.</p>
<p>The first line contains two numbers, <b>N</b> and <b>Q</b>, denoting  the number of police stations and 
       the number of queries respectively.</p>
<p>The second line contains two numbers, <b>R</b> and <b>key</b>, denoting the main station's id and 
       its encryption key. </p>
<p>Each of the next <b>N-1</b> lines contains three numbers: <b>u</b>, <b>v</b>, <b>k</b> which represent that there is a 
       telephone line from <b>v</b> to <b>u</b> and that <b>u</b>'s encryption key is <b>k</b>.</p>
<p>Each of the next <b>Q</b> lines contains a query of form:
<ul>
<li> <b>0 v u k</b>: A new station with id <b>u</b> and encryption key <b>k</b> is added and connected by 
                a telephone line to <b>v</b> </li>
<li> <b>1 v k</b>: The security test needs two encryption keys <b>a</b> and <b>b</b> such that <b>a</b> minimizes the value of <b>a xor k</b> and <b>b</b> that
               maximizes the value of <b>b xor k</b>. <b>a</b> and <b>b</b> are encryption keys that correspond to some nodes that lie on the path, formed by telephone lines,
               from police station <b>v</b> to Gordon's police station, <b>R</b>.</li>
</ul>
</p>

<p> The problem requires an <b>online solution</b>. Each query will be encoded using the xor between its real values and the value of the last answer. Please see the note section at the end of the statement to see a piece of code that
shows how the input should be read.</p>

<h3>Output</h3>
<p>For each operation of type 1, output a single line containing the two requested values (min-value and max-value) separated by a single space.</p>

<h3>Constraints</h3>
<ul>
<li>1 ≤ <b>N</b> ≤ 100,000</li>
<li>1 ≤ <b>Q</b> ≤ 200,000</li>
<li>1 ≤ <b>R, u<sub>i</sub>, v<sub>i</sub>, key, k<sub>i</sub></b> ≤ <b>2<sup>31</sup>− 1</b></li>
<li>All ids are <b>unique</b> (there aren't at any time two police stations with the same id).</li>
<li>Whenever you have to connect a node <b>u</b> to another one <b>v</b>, it is <b>guaranteed</b> that <b>v</b> is <b>already connected</b>, directly of indirectly, to <b>R</b>.
</ul>

<h3>Subtasks</h3>
<b>Subtask #1 (30 points):</b>
<ul>
<li><b>1</b> ≤ <b>N</b> ≤ <b>5000</b></li>
<li><b>1</b> ≤ <b>Q</b> ≤ <b>5000</b></li>
</ul>
<br>
<b>Subtask #2 (70 points):</b>
<ul>
<li>Original constraints</li>
</ul>

<h3>Example</h3>
<pre><b>Input:</b>
6 4
1 2
5 1 3
2 1 4
3 2 5
4 2 1
6 3 3
1 4 2
6 0 12 0
7 12 7
4 0 7


<b>Output:</b>
0 6
2 7
0 1
</pre>

<h3>Explanation</h3>
<p>
Initially, there are 6 police stations in Gotham and our heroes have 4 operations to perform
Gordon's station is the one that has id 1 and key 2.</p>

<p><b>First query: </b> The values on the path from <b>4</b> to <b>1</b> are <b>1 xor 2 = 3</b>, <b>4 xor 2 = 6</b> and <b>2 xor 2 = 0</b>. The answer is <b>0 6</b>.</p>
<p><b>Second query: </b> The values on the path from <b>10</b> to <b>1</b> are <b>6 xor 1 = 7</b>, <b>3 xor 1 = 2</b>, <b>5 xor 1 = 4</b>, <b>4 xor 1 = 5</b> and <b>2 xor 1 = 3</b>. The answer is <b>2 7</b>.</p>
<p><b>Third query: </b> The values on the path from <b>5</b> to <b>1</b> are <b>3 xor 2 = 1</b> and <b>2 xor 2 = 0</b>. The answer is <b>0 1</b>.</p>

The decoded version of all operations is:
<pre>
1 4 2    (t v k)
0 6 10 6 (t v u k)
1 10 1   (t v k)
1 5 2    (t v k)
</pre>

<h3>Note</h3>

<pre><code class="language-c++">
cin >> N >> Q;
cin >> R >> key;

for (i = 0; i < N - 1; i++)
{
    cin >> u >> v >> k;
}

int last_answer = 0;

for (i = 0; i < Q; i++)
{
    cin >> t;
    
    // find real value of t
    t ^= last_answer;

    if (t == 0)
    {
        cin >> v >> u >> k;
        
        // find real values for u, v, and k
        u ^= last_answer;
        v ^= last_answer;
        k ^= last_answer;
    }
    else
    {
        cin >> v >> k;

        // find real values for v, and k
        v ^= last_answer;
        k ^= last_answer;
        
        // compute the requested values
        int min_answer = ...
        int max_answer = ...

        // update last_answer
        last_answer = min_answer ^ max_answer;  
    }
}
</code></pre>