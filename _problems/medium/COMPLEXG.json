{"category_name":"medium","status":"success","problem_code":"COMPLEXG","problem_name":"A Complex Graph Problem","body":"A **weighted directed graph** consists of a set $V$ of **vertices** and a collection $E$ of **edges**. Each edge $e \\in E$ is an ordered triple $e = (x, y, w)$ where $x \\in V$ and $y \\in V$ are vertices, called the **start** and **end** vertices of $e$, respectively, and $w$ is a number called the **weight** of $e$.  \r\n\r\nA **walk** from vertex $s$ to vertex $t$ is an *alternating* sequence of vertices and edges $(v_1, e_1, v_2, e_2, \\ldots, e_{k-1}, v_k)$ (there are $k$ vertices and $k - 1$ edges in this sequence) satisfying the following:\r\n\r\n- $k \\ge 1$;\r\n- $v_1 = s$;  \r\n- $v_k = t$;  \r\n- The start vertex of $e_i$ is $v_i$ (for each $i$ from $1$ to $k - 1$);  \r\n- The end vertex of $e_i$ is $v_{i+1}$ (for each $i$ from $1$ to $k - 1$).  \r\n\r\nYou are given a special weighted directed graph $(V, E)$. The weights of the edges in this graph are **complex numbers**, that is, numbers of the form $a + bi$. Each complex weight $a + bi$ satisfies the following:\r\n\r\n- $a$ and $b$ are integers;\r\n- $a^2 + b^2 < 5$.  \r\n\r\nWe say that a walk from $s$ to $t$ is **real** if the **product** of the weights of the edges in it is a real number. We call this product the **cost** of the walk.  \r\n\r\nGiven two vertices $s$ and $t$, is there a **real** walk from $s$ to $t$? If so, what is the minimum possible cost of any real walk from $s$ to $t$? Note that:\r\n\r\n- It may be possible for the costs of the real walks to be arbitrarily small; you must also detect if this is the case.  \r\n- If $a$ and $b$ are integers for every edge weight $a + bi$, then it can be shown that the cost of any real walk is an integer. In particular, the minimum possible cost is an integer.\r\n- The minimum possible cost may be very large, so only output it modulo $998244353$.  \r\n\r\nThe product of two complex numbers $a + bi$ and $a' + b'i$ is defined by multiplying them via the distributive property and then reducing $i^2 = -1$. For example:\r\n\r\n$$\\begin{align*}\r\n(3 + 4i)\\cdot (4 - 7i)\r\n&= 3\\cdot 4 - 3\\cdot 7i + 4i\\cdot 4 - 4i\\cdot 7i \\\\\r\n&= 12 - 21i + 16i - 28i^2 \\\\\r\n&= 12 - 21i + 16i - 28(-1) \\\\\r\n&= 40 - 5i. \r\n\\end{align*}$$\r\n\r\nWe say that a complex number $a + bi$ is *real* if $b = 0$. In this case, we consider $a + bi$ equal to the real number $a$.  \r\n\r\nFor real numbers $m > 0$ and $a$, we define $(a \\bmod m)$ as the unique real number $a'$ such that $0 \\le a' < m$ and $a - a'$ is divisible by $m$.\r\n\r\n\r\n### Input\r\n\r\nThe first line contains $T$, the number of test cases. The following lines describe the test cases.  \r\n\r\nThe first line of each test case contains two space-separated integers $|V|$ and $|E|$, where $|V|$ denotes the number of vertices in $V$ and $|E|$ denotes the number of edges in $E$. For simplicity, the vertices are numbered $1$ to $|V|$. \r\n\r\nThe second line contains two space-separated integers $s$ and $t$ representing two vertices (which may be equal).\r\n\r\nThe next $|E|$ lines describe the edges. Each of the next $|E|$ lines contains four space-separated integers $x$, $y$, $a$ and $b$ denoting that $(x, y, a + bi)$ is an edge.  \r\n\r\n\r\n### Output\r\n\r\nFor each test case, output a single line containing:\r\n\r\n- An integer denoting the minimum possible cost of any real walk from $s$ to $t$. (This number must be reduced modulo $998244353$.)\r\n- The string `NEGATIVE INFINITY` if the costs of the real walks are arbitrarily small.\r\n- The string `NEGATIVE` if there is no real walk from $s$ to $t$. \r\n\r\n\r\n### Constraints \r\n\r\n- $1 \\leq T \\leq 10^4$  \r\n- $1 \\le |V| \\le 10^5$  \r\n- $0 \\le |E| \\le 10^5$  \r\n- The sum of the $|V|$ in a single file is $\\le 3\\cdot 10^5$  \r\n- The sum of the $|E|$ in a single file is $\\le 3\\cdot 10^5$  \r\n- $1 \\le s, t, x, y \\le |V|$  \r\n- $a^2 + b^2 < 5$  \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n- There may be edges with equal start and end vertices.\r\n- There may be multiple edges between the same pair of vertices.\r\n\r\n### Sample Input\r\n\r\n    4\r\n    2 2\r\n    2 1\r\n    1 2 1 0\r\n    2 1 2 0\r\n    5 5\r\n    1 2\r\n    1 3 1 1\r\n    3 4 1 0\r\n    4 5 0 1\r\n    5 3 -1 0\r\n    3 2 1 1\r\n    2 2\r\n    1 2\r\n    1 2 -2 0\r\n    2 1 0 -2\r\n    4 6\r\n    1 3\r\n    1 2 -1 1\r\n    1 3 1 -1\r\n    1 4 1 1\r\n    2 2 -1 0\r\n    2 3 0 -1\r\n    3 4 1 1\r\n\r\n\r\n### Sample Output\r\n\r\n    2\r\n    998244351\r\n    NEGATIVE INFINITY\r\n    NEGATIVE\r\n\r\n\r\n### Explanation\r\n\r\nIn the second test case, the answer is $-2$, and $-2$ reduced modulo $998244353$ is $998244351$.  \r\n\n<aside style='background: #f8f8f8;padding: 10px 15px;'><div>All submissions for this problem are available.<\/div><\/aside>","problemComponents":{"constraints":"","constraintsState":false,"subtasks":"","subtasksState":false,"statement":"A **weighted directed graph** consists of a set $V$ of **vertices** and a collection $E$ of **edges**. Each edge $e \\in E$ is an ordered triple $e = (x, y, w)$ where $x \\in V$ and $y \\in V$ are vertices, called the **start** and **end** vertices of $e$, respectively, and $w$ is a number called the **weight** of $e$.  \r\n\r\nA **walk** from vertex $s$ to vertex $t$ is an *alternating* sequence of vertices and edges $(v_1, e_1, v_2, e_2, \\ldots, e_{k-1}, v_k)$ (there are $k$ vertices and $k - 1$ edges in this sequence) satisfying the following:\r\n\r\n- $k \\ge 1$;\r\n- $v_1 = s$;  \r\n- $v_k = t$;  \r\n- The start vertex of $e_i$ is $v_i$ (for each $i$ from $1$ to $k - 1$);  \r\n- The end vertex of $e_i$ is $v_{i+1}$ (for each $i$ from $1$ to $k - 1$).  \r\n\r\nYou are given a special weighted directed graph $(V, E)$. The weights of the edges in this graph are **complex numbers**, that is, numbers of the form $a + bi$. Each complex weight $a + bi$ satisfies the following:\r\n\r\n- $a$ and $b$ are integers;\r\n- $a^2 + b^2 < 5$.  \r\n\r\nWe say that a walk from $s$ to $t$ is **real** if the **product** of the weights of the edges in it is a real number. We call this product the **cost** of the walk.  \r\n\r\nGiven two vertices $s$ and $t$, is there a **real** walk from $s$ to $t$? If so, what is the minimum possible cost of any real walk from $s$ to $t$? Note that:\r\n\r\n- It may be possible for the costs of the real walks to be arbitrarily small; you must also detect if this is the case.  \r\n- If $a$ and $b$ are integers for every edge weight $a + bi$, then it can be shown that the cost of any real walk is an integer. In particular, the minimum possible cost is an integer.\r\n- The minimum possible cost may be very large, so only output it modulo $998244353$.  \r\n\r\nThe product of two complex numbers $a + bi$ and $a' + b'i$ is defined by multiplying them via the distributive property and then reducing $i^2 = -1$. For example:\r\n\r\n$$\\begin{align*}\r\n(3 + 4i)\\cdot (4 - 7i)\r\n&= 3\\cdot 4 - 3\\cdot 7i + 4i\\cdot 4 - 4i\\cdot 7i \\\\\r\n&= 12 - 21i + 16i - 28i^2 \\\\\r\n&= 12 - 21i + 16i - 28(-1) \\\\\r\n&= 40 - 5i. \r\n\\end{align*}$$\r\n\r\nWe say that a complex number $a + bi$ is *real* if $b = 0$. In this case, we consider $a + bi$ equal to the real number $a$.  \r\n\r\nFor real numbers $m > 0$ and $a$, we define $(a \\bmod m)$ as the unique real number $a'$ such that $0 \\le a' < m$ and $a - a'$ is divisible by $m$.\r\n\r\n\r\n### Input\r\n\r\nThe first line contains $T$, the number of test cases. The following lines describe the test cases.  \r\n\r\nThe first line of each test case contains two space-separated integers $|V|$ and $|E|$, where $|V|$ denotes the number of vertices in $V$ and $|E|$ denotes the number of edges in $E$. For simplicity, the vertices are numbered $1$ to $|V|$. \r\n\r\nThe second line contains two space-separated integers $s$ and $t$ representing two vertices (which may be equal).\r\n\r\nThe next $|E|$ lines describe the edges. Each of the next $|E|$ lines contains four space-separated integers $x$, $y$, $a$ and $b$ denoting that $(x, y, a + bi)$ is an edge.  \r\n\r\n\r\n### Output\r\n\r\nFor each test case, output a single line containing:\r\n\r\n- An integer denoting the minimum possible cost of any real walk from $s$ to $t$. (This number must be reduced modulo $998244353$.)\r\n- The string `NEGATIVE INFINITY` if the costs of the real walks are arbitrarily small.\r\n- The string `NEGATIVE` if there is no real walk from $s$ to $t$. \r\n\r\n\r\n### Constraints \r\n\r\n- $1 \\leq T \\leq 10^4$  \r\n- $1 \\le |V| \\le 10^5$  \r\n- $0 \\le |E| \\le 10^5$  \r\n- The sum of the $|V|$ in a single file is $\\le 3\\cdot 10^5$  \r\n- The sum of the $|E|$ in a single file is $\\le 3\\cdot 10^5$  \r\n- $1 \\le s, t, x, y \\le |V|$  \r\n- $a^2 + b^2 < 5$  \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n- There may be edges with equal start and end vertices.\r\n- There may be multiple edges between the same pair of vertices.\r\n\r\n### Sample Input\r\n\r\n    4\r\n    2 2\r\n    2 1\r\n    1 2 1 0\r\n    2 1 2 0\r\n    5 5\r\n    1 2\r\n    1 3 1 1\r\n    3 4 1 0\r\n    4 5 0 1\r\n    5 3 -1 0\r\n    3 2 1 1\r\n    2 2\r\n    1 2\r\n    1 2 -2 0\r\n    2 1 0 -2\r\n    4 6\r\n    1 3\r\n    1 2 -1 1\r\n    1 3 1 -1\r\n    1 4 1 1\r\n    2 2 -1 0\r\n    2 3 0 -1\r\n    3 4 1 1\r\n\r\n\r\n### Sample Output\r\n\r\n    2\r\n    998244351\r\n    NEGATIVE INFINITY\r\n    NEGATIVE\r\n\r\n\r\n### Explanation\r\n\r\nIn the second test case, the answer is $-2$, and $-2$ reduced modulo $998244353$ is $998244351$.  \r\n","inputFormat":"","inputFormatState":false,"outputFormat":"","outputFormatState":false,"sampleTestCases":[]},"video_editorial_url":"","languages_supported":"CPP14, C, JAVA, PYTH 3.6, PYTH, PYP3, CS2, ADA, PYPY, TEXT, PAS fpc, NODEJS, RUBY, PHP, GO, HASK, TCL, PERL, SCALA, LUA, kotlin, BASH, JS, LISP sbcl, rust, PAS gpc, BF, CLOJ, R, D, CAML, FORT, ASM, swift, FS, WSPC, LISP clisp, SQL, SCM guile, PERL6, ERL, CLPS, ICK, NICE, PRLG, ICON, COB, SCM chicken, PIKE, SCM qobi, ST, NEM","max_timelimit":"4","source_sizelimit":"50000","problem_author":"kevinsogo","problem_author_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #D0011B;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>7&#9733;<\/span><span class='m-username--link'>kevinsogo<\/span>","problem_tester":null,"problem_tester_html_handle":"","date_added":"25-12-2019","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/kevinsogo'>kevinsogo<\/a>","problem_difficulty_level":"Medium","user_zen_mode":false,"best_tag":"","editorial_url":"","time":{"view_start_date":1577730600,"submit_start_date":1577730600,"visible_start_date":1577730600,"end_date":1735669800,"current":1643797932},"user":{"username":null,"access":"default"},"todo":false,"problem_status":"unattempted","is_direct_submittable":false,"problemDiscussURL":"https:\/\/discuss.codechef.com\/search?q=COMPLEXG","is_proctored":false,"is_user_verified_for_proctoring":null,"visitedContests":[]}