{"category_name":"medium","status":"success","problem_code":"RWALKS","problem_name":"Random Walk Queries","body":"### Read problem statements in [Bengali](https:\/\/www.codechef.com\/download\/translated\/MARCH21\/bengali\/RWALKS.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/MARCH21\/mandarin\/RWALKS.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/MARCH21\/russian\/RWALKS.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/MARCH21\/vietnamese\/RWALKS.pdf) as well.\r\n\r\nChef visited his native country Chefland for vacation. Chefland has $N$ towns (numbered $1$ through $N$) and $N-1$ bidirectional roads connecting the towns in such a way that it is possible to travel from each town to any other town.\r\n\r\nChef had a series of $Q$ tasks he wanted to perform in Chefland. There are two types of tasks:\r\n- `1 u d`: Chef should make a random walk with a maximum length $d$, starting from town $u$.\r\n- `2 u`: Write down the number of times Chef has visited town $u$ so far.\r\n\r\nA random walk with the above parameters $(u,d)$ is made in the following way:\r\n- First, Chef visits town $u$.\r\n- Then, he uniformly randomly chooses a neighbouring town of the town he is currently in (a town directly connected to it by a road), which has not been visited so far, and moves to it (visits it).\r\n- If there is no such town or he has already travelled a distance $d$ (visited $d+1$ towns), the walk ends.\r\n- Otherwise, Chef continues from step 2 again.\r\n\r\nHowever, there is an issue \u2015 Chef quickly forgets the exact paths he has travelled. Hence, he cannot write down exact numbers in tasks of the second type. He would like you to at least tell him, for each task of the second type, the expected value of the number he would write down in this task.\r\n\r\nHelp Chef and find these expected values. Note that Chef's sequence of tasks is encoded so that they have to be processed online. It can be proved that at any point, the expected number of times a city is visited can be expressed as a fraction $\\frac{P}{Q}$, where $P$ and $Q$ are non-negative integers and $Q$ is coprime with $10^9+7$. You should compute $P \\cdot Q^{-1}$ modulo $10^9+7$, where $Q^{-1}$ denotes the multiplicative inverse of $Q$ modulo $10^9+7$.\r\n\r\n### Input\r\n- The first line of the input contains two space-separated integers $N$ and $Q$.\r\n- Each of the next $N-1$ lines contains two space-separated integers $u$ and $v$ denoting that towns $u$ and $v$ are connected by a road.\r\n- Each of the next $Q$ lines describes a task as follows:\r\n    - Let $last$ denote the answer for the last task of the second type so far, or $last = 0$ if there are no such tasks yet.\r\n    - For a task of the first type, this line contains three space-separated integers $1$, $a$ and $b$. The starting town is decoded as $u = (last + a) \\% N + 1$ and the maximum length is decoded as $d = (last + b) \\% N + 1$.\r\n    - For a task of the second type, this line contains two space-separated integers $2$ and $a$. The town $u = (last + a) \\% N + 1$.\r\n\r\n### Output\r\nFor each task of the second type, print a single line containing one integer $P \\cdot Q^{-1}$ modulo $10^9+7$.\r\n\r\n### Constraints\r\n- $1 \\leq N \\leq 2 \\cdot 10^5$\r\n- $2 \\leq Q \\leq 10^5$\r\n- $1 \\leq u,v \\leq N$\r\n- $1 \\leq a,b \\leq N$\r\n\r\n### Subtasks\r\n**Subtask #1 (10 points, time limit 1 second):** $N,Q \\leq 10^3$\r\n\r\n**Subtask #2 (25 points, time limit 2 seconds):** $N,Q \\leq 5 \\cdot 10^4$\r\n\r\n**Subtask #3 (25 points, time limit 4 seconds):** all towns in Chefland lie on a single straight path\r\n\r\n**Subtask #4 (40 points, time limit 4 seconds):** original constraints\r\n\r\n### Example Input\r\n```\r\n6 4\r\n6 2\r\n3 2\r\n4 1\r\n1 2\r\n5 4\r\n1 6 2\r\n2 4\r\n1 2 3\r\n2 4\r\n```\r\n\r\n### Example Output\r\n```\r\n500000004\r\n1\r\n```\r\n\r\n### Explanation\r\n![](https:\/\/s3.amazonaws.com\/codechef_shared\/download\/Images\/MARCH21\/RWALKS\/RWALKS.png)\r\n\r\n- For task $1$, all the towns can possibly be visited in the random walk. The probabilities of visiting them are $\\left(1, \\frac{1}{2}, \\frac{1}{4}, \\frac{1}{2}, \\frac{1}{2}, \\frac{1}{4}\\right)$.\r\n- For task $2$, the expected number of times town $5$ would have been visited so far is $\\frac{1}{2}$.\r\n- For task $3$, the probabilities of visiting the towns during this random walk are $\\left(\\frac{1}{2}, 1, 1, \\frac{1}{2}, \\frac{1}{2}, \\frac{1}{2} \\right)$.\r\n- For task $4$, the expected number of times town $5$ would have been visited is $\\frac{1}{2} + \\frac{1}{2} = 1$.\r\n\n<aside style='background: #f8f8f8;padding: 10px 15px;'><div>All submissions for this problem are available.<\/div><\/aside>","problemComponents":{"constraints":"","constraintsState":false,"subtasks":"","subtasksState":false,"statement":"### Read problem statements in [Bengali](https:\/\/www.codechef.com\/download\/translated\/MARCH21\/bengali\/RWALKS.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/MARCH21\/mandarin\/RWALKS.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/MARCH21\/russian\/RWALKS.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/MARCH21\/vietnamese\/RWALKS.pdf) as well.\r\n\r\nChef visited his native country Chefland for vacation. Chefland has $N$ towns (numbered $1$ through $N$) and $N-1$ bidirectional roads connecting the towns in such a way that it is possible to travel from each town to any other town.\r\n\r\nChef had a series of $Q$ tasks he wanted to perform in Chefland. There are two types of tasks:\r\n- `1 u d`: Chef should make a random walk with a maximum length $d$, starting from town $u$.\r\n- `2 u`: Write down the number of times Chef has visited town $u$ so far.\r\n\r\nA random walk with the above parameters $(u,d)$ is made in the following way:\r\n- First, Chef visits town $u$.\r\n- Then, he uniformly randomly chooses a neighbouring town of the town he is currently in (a town directly connected to it by a road), which has not been visited so far, and moves to it (visits it).\r\n- If there is no such town or he has already travelled a distance $d$ (visited $d+1$ towns), the walk ends.\r\n- Otherwise, Chef continues from step 2 again.\r\n\r\nHowever, there is an issue \u2015 Chef quickly forgets the exact paths he has travelled. Hence, he cannot write down exact numbers in tasks of the second type. He would like you to at least tell him, for each task of the second type, the expected value of the number he would write down in this task.\r\n\r\nHelp Chef and find these expected values. Note that Chef's sequence of tasks is encoded so that they have to be processed online. It can be proved that at any point, the expected number of times a city is visited can be expressed as a fraction $\\frac{P}{Q}$, where $P$ and $Q$ are non-negative integers and $Q$ is coprime with $10^9+7$. You should compute $P \\cdot Q^{-1}$ modulo $10^9+7$, where $Q^{-1}$ denotes the multiplicative inverse of $Q$ modulo $10^9+7$.\r\n\r\n### Input\r\n- The first line of the input contains two space-separated integers $N$ and $Q$.\r\n- Each of the next $N-1$ lines contains two space-separated integers $u$ and $v$ denoting that towns $u$ and $v$ are connected by a road.\r\n- Each of the next $Q$ lines describes a task as follows:\r\n    - Let $last$ denote the answer for the last task of the second type so far, or $last = 0$ if there are no such tasks yet.\r\n    - For a task of the first type, this line contains three space-separated integers $1$, $a$ and $b$. The starting town is decoded as $u = (last + a) \\% N + 1$ and the maximum length is decoded as $d = (last + b) \\% N + 1$.\r\n    - For a task of the second type, this line contains two space-separated integers $2$ and $a$. The town $u = (last + a) \\% N + 1$.\r\n\r\n### Output\r\nFor each task of the second type, print a single line containing one integer $P \\cdot Q^{-1}$ modulo $10^9+7$.\r\n\r\n### Constraints\r\n- $1 \\leq N \\leq 2 \\cdot 10^5$\r\n- $2 \\leq Q \\leq 10^5$\r\n- $1 \\leq u,v \\leq N$\r\n- $1 \\leq a,b \\leq N$\r\n\r\n### Subtasks\r\n**Subtask #1 (10 points, time limit 1 second):** $N,Q \\leq 10^3$\r\n\r\n**Subtask #2 (25 points, time limit 2 seconds):** $N,Q \\leq 5 \\cdot 10^4$\r\n\r\n**Subtask #3 (25 points, time limit 4 seconds):** all towns in Chefland lie on a single straight path\r\n\r\n**Subtask #4 (40 points, time limit 4 seconds):** original constraints","inputFormat":"","inputFormatState":false,"outputFormat":"","outputFormatState":false,"sampleTestCases":[{"id":"1","input":"6 4\r\n6 2\r\n3 2\r\n4 1\r\n1 2\r\n5 4\r\n1 6 2\r\n2 4\r\n1 2 3\r\n2 4","output":"500000004\r\n1","explanation":"![](https:\/\/s3.amazonaws.com\/codechef_shared\/download\/Images\/MARCH21\/RWALKS\/RWALKS.png)\r\n\r\n- For task $1$, all the towns can possibly be visited in the random walk. The probabilities of visiting them are $\\left(1, \\frac{1}{2}, \\frac{1}{4}, \\frac{1}{2}, \\frac{1}{2}, \\frac{1}{4}\\right)$.\r\n- For task $2$, the expected number of times town $5$ would have been visited so far is $\\frac{1}{2}$.\r\n- For task $3$, the probabilities of visiting the towns during this random walk are $\\left(\\frac{1}{2}, 1, 1, \\frac{1}{2}, \\frac{1}{2}, \\frac{1}{2} \\right)$.\r\n- For task $4$, the expected number of times town $5$ would have been visited is $\\frac{1}{2} + \\frac{1}{2} = 1$.","isDeleted":false}]},"video_editorial_url":"","languages_supported":"CPP14, C, JAVA, PYTH 3.6, CPP17, PYTH, PYP3, CS2, ADA, PYPY, TEXT, PAS fpc, NODEJS, RUBY, PHP, GO, HASK, TCL, PERL, SCALA, LUA, kotlin, BASH, JS, LISP sbcl, rust, PAS gpc, BF, CLOJ, R, D, CAML, FORT, ASM, swift, FS, WSPC, LISP clisp, SQL, SCM guile, PERL6, ERL, CLPS, ICK, NICE, PRLG, ICON, COB, SCM chicken, PIKE, SCM qobi, ST, SQLQ, NEM","max_timelimit":"1 - 4","source_sizelimit":"50000","problem_author":"shaanknight","problem_author_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #FFBF00;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>5&#9733;<\/span><span class='m-username--link'>shaanknight<\/span>","problem_tester":"","problem_tester_html_handle":"","date_added":"26-02-2021","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/centroid-decomposition'>centroid-decomposition<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/lowest-common-ancestor'>lowest-common-ancestor<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/march21'>march21<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/medium-hard'>medium-hard<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/shaanknight'>shaanknight<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/trie'>trie<\/a>","problem_difficulty_level":"Medium-Hard","user_zen_mode":false,"best_tag":"Lowest Common Ancestor","editorial_url":"https:\/\/discuss.codechef.com\/problems\/RWALKS","time":{"view_start_date":1104528600,"submit_start_date":1104528600,"visible_start_date":1104528600,"end_date":1735669800,"current":1643797973},"user":{"username":null,"access":"default"},"todo":false,"problem_status":"unattempted","is_direct_submittable":false,"problemDiscussURL":"https:\/\/discuss.codechef.com\/search?q=RWALKS","is_proctored":false,"is_user_verified_for_proctoring":null,"visitedContests":[]}