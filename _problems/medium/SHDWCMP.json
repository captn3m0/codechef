{"category_name":"medium","status":"success","problem_code":"SHDWCMP","problem_name":"Company Club Membership","body":"<span class=\"solution-visible-txt\">All submissions for this problem are available.<\/span><h3>Read problems statements in <a target=\"_blank\" \nhref=\"http:\/\/www.codechef.com\/download\/translated\/LTIME49\/mandarin\/SHDWCMP.pdf\">mandarin chinese<\/a>, <a target=\"_blank\" \nhref=\"http:\/\/www.codechef.com\/download\/translated\/LTIME49\/russian\/SHDWCMP.pdf\">russian<\/a> and <a target=\"_blank\" \nhref=\"http:\/\/www.codechef.com\/download\/translated\/LTIME49\/vietnamese\/SHDWCMP.pdf\">vietnamese<\/a> as well.<\/h3>\n\n<p>You are working in a company with <b>N<\/b> employees numbered from <b>0<\/b> to <b>N - 1<\/b>, and employee <b>0<\/b> is the director. Each employee, except the director, has a supervisor. The director doesn't have a supervisor. Let's call employee <b>v<\/b>, an ancestor of employee <b>u<\/b> if and only if <b>v<\/b> is the supervisor of <b>u<\/b> or <b>v<\/b> is an ancestor of the supervisor of <b>u<\/b>.<\/p>\n\n<p>Also, each employee belongs to exactly one club at any moment. Employee <b>i<\/b> belongs to club number <b>C<sub>i<\/sub><\/b> initially. The company has assemblies for which all the employees of the company gather. During an assembly, the employees introduce each other, in a particular fashion. Employee <b>v<\/b> introduces employee <b>a<\/b> to employee <b>b<\/b> if <b>a, b,\nv<\/b> are from the same club, <b>a<\/b> is ancestor of <b>v<\/b> and <b>v<\/b> is ancestor of <b>b<\/b>.<p>\n<p>Also some employees may change their club. You are given these changes, and you need to calculate the total number of introduces if an assembly was to be held after each such club membership change.<\/p>\n\n<h3>Input<\/h3>\n<ul>\n<li>The first line contains two integers, <b>N<\/b> and <b>Q<\/b>, denoting the number of employees in the company and the number of club membership changes, respectively.<\/li>\n<li>The second line contains <b>N - 1<\/b> space-separated integers: <b>P<sub>1<\/sub><\/b>, <b>P<sub>2<\/sub><\/b>, ..., <b>P<sub>N - 1<\/sub><\/b>, denoting the supervisors. <b>P<sub>i<\/sub><\/b> is the supervisor of employee <b>i<\/b>.<\/li>\n<li>The third line contains <b>N<\/b> space-separated integers: <b>C<sub>0<\/sub><\/b>, <b>C<sub>1<\/sub><\/b>, ..., <b>C<sub>N - 1<\/sub><\/b>, denoting the clubs. <b>C<sub>i<\/sub><\/b> is the club that employee <b>i<\/b> belongs to initially.<\/li>\n<li>Then, <b>Q<\/b> lines follow which contain the numbers <b>X<sub>1<\/sub><\/b>, <b>X<sub>2<\/sub><\/b>, .., <b>X<sub>Q<\/sub><\/b>, one in each line. That is, line number <b>i + 3<\/b> contains <b>X<sub>i<\/sub><\/b>. What it denotes is explained below.<\/li>\n<\/ul>\n<p><\/p>\n<p>The queries are encoded, and have to be decoded online. The i-th change (i running from 1 to <b>Q<\/b>) is that employee number (<b>i<\/b> - 1) mod <b>N<\/b> changes his club to (<b>X<sub>i<\/sub> + ans<\/b>) mod <b>N<\/b>. Where <b>ans<\/b> is the previous output (Note that, even for i = 1, there is a \"previous output\", because as is explained below, the first output has to be before any change).<\/p>\n\n\n<h3>Output<\/h3>\n<p>You have to output <b>Q + 1<\/b> lines. Line number <b>i + 1<\/b> should contain the answer for the original company after first <b>i<\/b> changes. That is, you should output the answer for the original company, and then after each club membership change.<\/p>\n\n<h3>Constraints<\/h3>\n<ul>\n<li><b>1<\/b> \u2264 <b>N<\/b> \u2264 <b>500000<\/b><\/li>\n<li><b>1<\/b> \u2264 <b>Q<\/b> \u2264 <b>500000<\/b><\/li>\n<li><b>0<\/b> \u2264 <b>P<sub>i<\/sub><\/b> < <b>i<\/b><\/li>\n<li><b>0<\/b> \u2264 <b>C<sub>i<\/sub><\/b> < <b>N<\/b><\/li>\n<li><b>0<\/b> \u2264 <b>X<sub>i<\/sub><\/b> < <b>N<\/b><\/li>\n<\/ul>\n\n<h3>Subtasks<\/h3>\n<ul>\n<li>Subtask #1 (30 points): <b>N<\/b>, <b>Q<\/b> \u2264 <b>2000<\/b><\/li>\n<li>Subtask #2 (20 points): <b>N<\/b> \u2264 <b>2000<\/b><\/li>\n<li>Subtask #3 (35 points): <b>N<\/b>, <b>Q<\/b> \u2264 <b>100000<\/b><\/li>\n<li>Subtask #4 (15 points): Original constraints<\/li>\n<\/ul>\n\n<h3>Example<\/h3>\n<pre><b>Input:<\/b>\n9 2\n0 0 1 1 2 3 3 5\n1 0 1 0 2 1 0 0 1\n5\n8\n\n<b>Output:<\/b>\n6\n3\n2\n<\/pre>\n\n<h3>Explanation<\/h3>\n<p>We represent employee <b>v<\/b> introducing employee <b>a<\/b> to employee <b>b<\/b>, by the triplet (<b>a, v, b<\/b>).<\/p>\n\n<p>Initially, before any change, there are a total of 6 introduces. They are:\n<ul>\n<li>(0, 2, 5)<\/li>\n<li>(0, 2, 8)<\/li>\n<li>(0, 5, 8)<\/li>\n<li>(2, 5, 8)<\/li>\n<li>(1, 3, 6)<\/li>\n<li>(1, 3, 7)<\/li>\n<\/ul>\n<p><\/p>\nSo, the first output is 6. So <b>ans<\/b> = 6 now.<\/p>\n\n<p>To decode the first change, we consider (<b>X<sub>1<\/sub> + ans<\/b>) mod <b>N<\/b> = (5 + 6) mod 9 = 2. So, employee (<b>i<\/b> - 1) mod <b>N<\/b> = employee 0, changes his club to 2. After this change, the number of introduces reduces. There is no new introduce triplet formed, but the triplets (0, 2, 5), (0, 2, 8) and (0, 5, 8) are no longer valid. Hence, there are only 3 introduces which are:\n<ul>\n<li>(2, 5, 8)<\/li>\n<li>(1, 3, 6)<\/li>\n<li>(1, 3, 7)<\/li>\n<\/ul>\n<p><\/p>\n<p>So the second output is 3, and <b>ans<\/b> becomes 3 now.<\/p>\n\n<p>To decode the second change, we consider (<b>X<sub>2<\/sub> + ans<\/b>) mod <b>N<\/b> = (8 + 3) mod 9 = 2. So, employee (<b>i<\/b> - 1) mod <b>N<\/b> = employee 1, changes his club to 2. Now, some old introduces are lost, and some new ones formed. The introduces after this change are:\n<ul>\n<li>(2, 5, 8)<\/li>\n<li>(0, 1, 4)<\/li>\n<\/ul>\n<p><\/p>\n<p>So the third output is 2.<\/p>","languages_supported":"ADA, ASM, BASH, BF, C, C99 strict, CAML, CLOJ, CLPS, CPP 4.3.2, CPP 6.3, CPP14, CS2, D, ERL, FORT, FS, GO, HASK, ICK, ICON, JAVA, JS, LISP clisp, LISP sbcl, LUA, NEM, NICE, NODEJS, PAS fpc, PAS gpc, PERL, PERL6, PHP, PIKE, PRLG, PYPY, PYTH, PYTH 3.5, RUBY, SCALA, SCM chicken, SCM guile, SCM qobi, ST, TCL, TEXT, WSPC","max_timelimit":"1 - 3","source_sizelimit":"50000","problem_author":"grumpy_gordon","problem_author_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #3366CC;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>3&#9733;<\/span><span>grumpy_gordon<\/span>","problem_tester":"lg5293","problem_tester_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #D0011B;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>7&#9733;<\/span><span>lg5293<\/span>","date_added":"20-06-2017","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/binary-search'>\n                    binary-search\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/dfs'>\n                    dfs\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/grumpy_gordon'>\n                    grumpy_gordon\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/hard'>\n                    hard\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/ltime49'>\n                    ltime49\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/partial-sums'>\n                    partial-sums\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/segment-tree'>\n                    segment-tree\n                <\/a>","time":{"view_start_date":1498323600,"submit_start_date":1498323600,"visible_start_date":1498323600,"end_date":1735669800,"current":1514817224},"user":{"username":null},"todo":false,"problem_status":"unattempted"}