{"category_name":"medium","status":"success","problem_code":"CIRCOLOR","problem_name":"Circle Coloring","body":"### Read problem statements in [Hindi](https:\/\/www.codechef.com\/download\/translated\/LTIME90\/hindi\/CIRCOLOR.pdf), [Bengali](https:\/\/www.codechef.com\/download\/translated\/LTIME90\/bengali\/CIRCOLOR.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/LTIME90\/mandarin\/CIRCOLOR.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/LTIME90\/russian\/CIRCOLOR.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/LTIME90\/vietnamese\/CIRCOLOR.pdf) as well.\r\n\r\nYou are given $N$ sets of integers $A_1, A_2, \\ldots, A_N$. For each valid $i$, let's denote the elements of the set $A_i$ by $\\{c_{i,1}, c_{i,2}, \\ldots, c_{i,|A_i|}\\}$.\r\n\r\nFind the number of ways to choose a sequence $(a_1, a_2, \\ldots, a_N)$ such that:\r\n- $a_i \\in A_i$ for each valid $i$\r\n- $a_i \\neq a_{i+1}$ for each valid $i$ and $a_1 \\neq a_N$\r\n\r\nSince this number may be large, compute it modulo $998,244,353$.\r\n\r\n### Input\r\n- The first line of the input contains a single integer $N$.\r\n- $N$ lines follow. For each valid $i$, the $i$-th of these lines contains an integer $|A_i|$ followed by a space and $|A_i|$ space-separated non-negative integers $c_{i,1}, c_{i,2}, \\ldots, c_{i,|A_i|}$.\r\n\r\n### Output\r\nPrint a single line containing one integer \u2015 the number of ways to choose $(a_1, a_2, \\ldots, a_N)$, modulo $998,244,353$.\r\n\r\n### Constraints \r\n- $2 \\le N \\le 200,000$\r\n- $|A_i| \\ge 1$ for each valid $i$\r\n- $|A_1| + |A_2| + \\ldots + |A_N| \\le 200,000$\r\n- $1 \\le c_{i,j} \\le 200000$ for each valid $i, j$\r\n\r\n### Subtasks\r\n**Subtask #1 (20 points):** $N \\le 100$\r\n\r\n**Subtask #2 (80 points):** original constraints\r\n\r\n### Example Input\r\n```\r\n3\r\n3 1 2 3\r\n2 1 2\r\n2 2 3\r\n```\r\n\r\n### Example Output\r\n```\r\n3\r\n```\r\n\r\n### Explanation\r\nThere are three possible sequences: $(1, 2, 3)$, $(2, 1, 3)$ and $(3, 1, 2)$.\r\n\n<aside style='background: #f8f8f8;padding: 10px 15px;'><div>All submissions for this problem are available.<\/div><\/aside>","problemComponents":{"constraints":"","constraintsState":false,"subtasks":"","subtasksState":false,"statement":"### Read problem statements in [Hindi](https:\/\/www.codechef.com\/download\/translated\/LTIME90\/hindi\/CIRCOLOR.pdf), [Bengali](https:\/\/www.codechef.com\/download\/translated\/LTIME90\/bengali\/CIRCOLOR.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/LTIME90\/mandarin\/CIRCOLOR.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/LTIME90\/russian\/CIRCOLOR.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/LTIME90\/vietnamese\/CIRCOLOR.pdf) as well.\r\n\r\nYou are given $N$ sets of integers $A_1, A_2, \\ldots, A_N$. For each valid $i$, let's denote the elements of the set $A_i$ by $\\{c_{i,1}, c_{i,2}, \\ldots, c_{i,|A_i|}\\}$.\r\n\r\nFind the number of ways to choose a sequence $(a_1, a_2, \\ldots, a_N)$ such that:\r\n- $a_i \\in A_i$ for each valid $i$\r\n- $a_i \\neq a_{i+1}$ for each valid $i$ and $a_1 \\neq a_N$\r\n\r\nSince this number may be large, compute it modulo $998,244,353$.\r\n\r\n### Input\r\n- The first line of the input contains a single integer $N$.\r\n- $N$ lines follow. For each valid $i$, the $i$-th of these lines contains an integer $|A_i|$ followed by a space and $|A_i|$ space-separated non-negative integers $c_{i,1}, c_{i,2}, \\ldots, c_{i,|A_i|}$.\r\n\r\n### Output\r\nPrint a single line containing one integer \u2015 the number of ways to choose $(a_1, a_2, \\ldots, a_N)$, modulo $998,244,353$.\r\n\r\n### Constraints \r\n- $2 \\le N \\le 200,000$\r\n- $|A_i| \\ge 1$ for each valid $i$\r\n- $|A_1| + |A_2| + \\ldots + |A_N| \\le 200,000$\r\n- $1 \\le c_{i,j} \\le 200000$ for each valid $i, j$\r\n\r\n### Subtasks\r\n**Subtask #1 (20 points):** $N \\le 100$\r\n\r\n**Subtask #2 (80 points):** original constraints","inputFormat":"","inputFormatState":false,"outputFormat":"","outputFormatState":false,"sampleTestCases":[{"id":"1","input":"3\r\n3 1 2 3\r\n2 1 2\r\n2 2 3","output":"3","explanation":"There are three possible sequences: $(1, 2, 3)$, $(2, 1, 3)$ and $(3, 1, 2)$.","isDeleted":false}]},"video_editorial_url":"https:\/\/youtu.be\/BrDD5gj7ncE","languages_supported":"CPP14, C, JAVA, PYTH 3.6, CPP17, PYTH, PYP3, CS2, ADA, PYPY, TEXT, PAS fpc, NODEJS, RUBY, PHP, GO, HASK, TCL, PERL, SCALA, LUA, kotlin, BASH, JS, LISP sbcl, rust, PAS gpc, BF, CLOJ, R, D, CAML, FORT, ASM, swift, FS, WSPC, LISP clisp, SQL, SCM guile, PERL6, ERL, CLPS, ICK, NICE, PRLG, ICON, COB, SCM chicken, PIKE, SCM qobi, ST, SQLQ, NEM","max_timelimit":"1","source_sizelimit":"50000","problem_author":"ildar_adm","problem_author_html_handle":"ildar_adm","problem_tester":"","problem_tester_html_handle":"","date_added":"27-11-2020","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/combinatorics'>combinatorics<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/dynamic-programming'>dynamic-programming<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/ildar_adm'>ildar_adm<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/ltime90'>ltime90<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/medium-hard'>medium-hard<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/square-root-decomposition'>square-root-decomposition<\/a>","problem_difficulty_level":"Medium-Hard","user_zen_mode":false,"best_tag":"Dynamic Programming","editorial_url":"https:\/\/discuss.codechef.com\/problems\/CIRCOLOR","time":{"view_start_date":1104528600,"submit_start_date":1104528600,"visible_start_date":1104528600,"end_date":1735669800,"current":1643797930},"user":{"username":null,"access":"default"},"todo":false,"problem_status":"unattempted","is_direct_submittable":false,"problemDiscussURL":"https:\/\/discuss.codechef.com\/search?q=CIRCOLOR","is_proctored":false,"is_user_verified_for_proctoring":null,"visitedContests":[]}