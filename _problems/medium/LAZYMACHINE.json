{"category_name":"medium","status":"success","problem_code":"LAZYMACHINE","problem_name":"Lazy Machine","body":"### Read problem statements in [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/SNCK1A21\/mandarin\/LAZYMACHINE.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/SNCK1A21\/russian\/LAZYMACHINE.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/SNCK1A21\/vietnamese\/LAZYMACHINE.pdf) as well.\n\nYou're given an array $A$ with $N$ integers. \nDefine $F(A, i, j) = (A[j]-A[i]) \\cdot (j-i)$.\n\nConsider the set $P$ of all pairs $(i, j)$ such that $1 \\leq i \\lt j  \\leq N$. For a subset $S$ of $P$, we define $\\texttt{beauty}(S, A)$ as the sum of $F(A, i, j)$ over all pairs $(i, j)$ contained in $S$. We also define $V(A)$ as the maximum value of $\\texttt{beauty}(S, A)$ over all subsets $S$ of $P$.\n\nYou also have a machine that takes a copy of the initial array $A$ as an input and performs $K$ pre-defined operations on it in a fixed order. In each operation, it takes two indices, $X_i$ and $Y_i$, and swaps the elements present at those positions in the array at that moment in time. After that, it outputs the final array. You know what these operations are and the order in which they are performed.\n\nHowever, the machine is a bit lazy. It may skip some operations. But the order of operations does not change. In other words, it chooses a subsequence (possibly empty) of the operations and performs them in that order.\n\nFind the sum of $V(P)$ over all possible outputs $P$ of the machine (modulo $10^9+7$).\n\nIn other words, consider the multiset $R$ of the arrays we get as an output after the machine takes input as $A$ and performs one of the subsequences (possibly empty) of the pre-defined operations. Note that there can be multiple occurrences of the same array in this multiset. Find the value $\\sum\\limits_{P \\in R} V(P)$.\n\nOutput the remainder of this value when divided by $10^9+7$.\n<aside style='background: #f8f8f8;padding: 10px 15px;'><div>All submissions for this problem are available.<\/div><\/aside>","problemComponents":{"constraints":"- $1 \u2264 T \u2264 10^3$\n- $2 \u2264 N \u2264 4 \\cdot 10^3$\n- $1 \u2264 K \u2264 4 \\cdot 10^3$\n- $-10^9 \u2264 A[i] \u2264 10^9$\n- $1 \u2264 X_i \\lt Y_i \u2264 N$\n- Sum of $N$ over all test cases is at most $4 \\cdot 10^3$.\n- Sum of $K$ over all test cases is at most $4 \\cdot 10^3$.","constraintsState":true,"subtasks":"- 30 points : $1 \\leq R \\leq 10000$\n- 70 points : $1 \\leq R \\leq 10^9$\n","subtasksState":false,"statement":"### Read problem statements in [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/SNCK1A21\/mandarin\/LAZYMACHINE.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/SNCK1A21\/russian\/LAZYMACHINE.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/SNCK1A21\/vietnamese\/LAZYMACHINE.pdf) as well.\n\nYou're given an array $A$ with $N$ integers. \nDefine $F(A, i, j) = (A[j]-A[i]) \\cdot (j-i)$.\n\nConsider the set $P$ of all pairs $(i, j)$ such that $1 \\leq i \\lt j  \\leq N$. For a subset $S$ of $P$, we define $\\texttt{beauty}(S, A)$ as the sum of $F(A, i, j)$ over all pairs $(i, j)$ contained in $S$. We also define $V(A)$ as the maximum value of $\\texttt{beauty}(S, A)$ over all subsets $S$ of $P$.\n\nYou also have a machine that takes a copy of the initial array $A$ as an input and performs $K$ pre-defined operations on it in a fixed order. In each operation, it takes two indices, $X_i$ and $Y_i$, and swaps the elements present at those positions in the array at that moment in time. After that, it outputs the final array. You know what these operations are and the order in which they are performed.\n\nHowever, the machine is a bit lazy. It may skip some operations. But the order of operations does not change. In other words, it chooses a subsequence (possibly empty) of the operations and performs them in that order.\n\nFind the sum of $V(P)$ over all possible outputs $P$ of the machine (modulo $10^9+7$).\n\nIn other words, consider the multiset $R$ of the arrays we get as an output after the machine takes input as $A$ and performs one of the subsequences (possibly empty) of the pre-defined operations. Note that there can be multiple occurrences of the same array in this multiset. Find the value $\\sum\\limits_{P \\in R} V(P)$.\n\nOutput the remainder of this value when divided by $10^9+7$.","inputFormat":"- The first line contains one integer $T$ \u2014 the number of test cases. Then $T$ test cases follow. \n- For each test case, the first line contains integers $N$ and $K$, the length of array $A$ and the number of predefined operations respectively. \n- The second line contains $N$ integers $A[1], A[2], \\dots A[N]$.\n- Then $K$ lines follow. The $i$-th of these lines contains integers $X_i$ and $Y_i$, the indices to be swapped in the $i$-th operation.\n","inputFormatState":true,"outputFormat":"For each test case, output the answer to the problem modulo $10^9+7$ on a separate line.","outputFormatState":true,"sampleTestCases":[{"id":"1","input":"1\n3 2\n1 2 3\n1 2\n2 3","output":"15","explanation":"There are 4 ways to select a subsequence from the given list of 2 operations:\n\n- **Perform both operations 1 and 2:** After swapping values at indices 1 and 2, the array becomes $[2, 1, 3]$. Then, after swapping values at indices 2 and 3, the array finally becomes $[2, 3, 1]$. One of the ways to get the greatest beauty in this array is by by choosing $S = \\{(1, 2)\\}$, ending up with $V(A) = F(A, 1, 2) = (A[2]-A[1]) \\cdot (2-1) = (3-2) \\cdot (2-1) = 1$\n- **Perform only operation 1:** After swapping values at indices 1 and 2, the array becomes $[2, 1, 3]$. For this final array, $V(A) = 4$.\n- **Perform only operation 2:** After swapping values at indices 2 and 3, the array becomes $[1, 3, 2]$. For this final array, $V(A) = 4$.\n- **Perform no operations:** The array $A$ remains $[1, 2, 3]$. Here, $V(A) = 6$.\n\nHence, our final answer is $(1+4+4+6)$, which leaves a remainder $15$ when divided by $10^9+7$.","isDeleted":false}]},"video_editorial_url":"","languages_supported":"CPP14, C, JAVA, PYTH 3.6, CPP17, PYTH, PYP3, CS2, ADA, PYPY, TEXT, PAS fpc, NODEJS, RUBY, PHP, GO, HASK, TCL, PERL, SCALA, LUA, kotlin, BASH, JS, LISP sbcl, rust, PAS gpc, BF, CLOJ, R, D, CAML, FORT, ASM, swift, FS, WSPC, LISP clisp, SQL, SCM guile, PERL6, ERL, CLPS, ICK, NICE, PRLG, ICON, COB, SCM chicken, PIKE, SCM qobi, ST, SQLQ, NEM","max_timelimit":"2","source_sizelimit":"50000","problem_author":"shivensinha4","problem_author_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #FF7F00;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>6&#9733;<\/span><span class='m-username--link'>shivensinha4<\/span>","problem_tester":"","problem_tester_html_handle":"","date_added":"18-10-2021","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/dynamic-programming'>dynamic-programming<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/medium-hard'>medium-hard<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/shivensinha4'>shivensinha4<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/snck1a21'>snck1a21<\/a>","problem_difficulty_level":"Hard","user_zen_mode":false,"best_tag":"Dynamic Programming","editorial_url":"https:\/\/discuss.codechef.com\/problems\/LAZYMACHINE","time":{"view_start_date":1635003000,"submit_start_date":1635003000,"visible_start_date":1635003000,"end_date":1735669800,"current":1643797954},"user":{"username":null,"access":"default"},"todo":false,"problem_status":"unattempted","is_direct_submittable":false,"problemDiscussURL":"https:\/\/discuss.codechef.com\/search?q=LAZYMACHINE","is_proctored":false,"is_user_verified_for_proctoring":null,"visitedContests":[]}