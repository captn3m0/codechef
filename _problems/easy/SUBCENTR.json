{"category_name":"easy","status":"success","problem_code":"SUBCENTR","problem_name":"Subtree Center","body":"### Read problem statements in [Bengali](https:\/\/www.codechef.com\/download\/translated\/START4\/bengali\/SUBCENTR.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/START4\/mandarin\/SUBCENTR.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/START4\/russian\/SUBCENTR.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/START4\/vietnamese\/SUBCENTR.pdf) as well.\n\nYou are given a tree with $N$ nodes (numbered $1$ through $N$) and $Q$ queries (numbered $1$ through $Q$). For each valid $i$, in the $i$-th query, you are given $K_i$ nodes $x_1, x_2, \\ldots, x_{K_i}$. Consider the smallest subtree which contains all of these nodes; you should find all centers of this subtree.\n\nA node is called a *center* of a tree if it lies in the middle of at least one longest path in that tree. Note that there may be multiple longest paths (paths with the same maximum length) and for a longest path which contains an even number of nodes, there are two nodes lying in the middle of this path.\n\n**Note:** A subtree here refers to a connected subgraph of the tree. Selecting a node does not mean all its descendants have to be selected.\n\n### Input\n- The first line of the input contains a single integer $T$ denoting the number of test cases. The description of $T$ test cases follows.\n- The first line of each test case contains two space-separated integers $N$ and $Q$.\n- $N-1$ lines follow. For each valid $i$, the $i$-th of these lines contains two space-separated integers $u$ and $v$ denoting that there is an edge between nodes $u$ and $v$ in the tree.\n- $Q$ more lines follow. For each valid $i$, the $i$-th of these lines contains an integer $K_i$, followed by a space and $K_i$ space-separated integers $x_1, x_2, \\ldots, x_{K_i}$.\n\n**Note:** The input and output of this problem are large, so prefer using fast input\/output methods.\n\n### Output\nFor each query, print a single line containing an integer $C$ denoting the number of centers, followed by a space and $C$ space-separated integers \u2014 the nodes which are centers of the given subtree, sorted in increasing order.\n\n### Constraints\n- $1 \\le T \\le 10^5$\n- $1 \\leq N \\leq 10^5$\n- $1 \\leq u, v \\leq N$\n- the graph described on the input is a tree\n- $1 \\le Q \\le 10^6$\n- $1 \\leq x_i \\leq N$ for each valid $i$\n- for each query, $x_1, x_2, \\ldots, x_{K_i}$ are pairwise distinct\n- the sum of $N$ over all test cases does not exceed $5 \\cdot 10^5$\n- the sum of $K_i$ over all queries in all test cases does not exceed $10^6$\n\n### Example Input\n```\n2\n3 2\n1 2\n2 3\n2 1 3\n2 1 2\n5 2\n1 2\n2 3\n2 4\n3 5\n1 2\n2 4 5\n```\n\n### Example Output\n```\n1 2\n2 1 2\n1 2\n2 2 3\n```\n\t\n### Explanation\n**Example case 1:** The figure below describes the second query. The smallest subtree containing the given nodes is coloured red and the nodes which are its centers are coloured blue.\n\n<img src=\"https:\/\/s3.amazonaws.com\/codechef_shared\/download\/Images\/DAANISH\/2.png\" width=\"450\" height=\"378\" \/>\n\n**Example case 2:** The figure below describes the second query with subtree and centers coloured in the same way.\n\n<img src=\"https:\/\/s3.amazonaws.com\/codechef_shared\/download\/Images\/DAANISH\/1.png\" width=\"450\" height=\"378\" \/>\n\n<aside style='background: #f8f8f8;padding: 10px 15px;'><div>All submissions for this problem are available.<\/div><\/aside>","problemComponents":{"constraints":"","constraintsState":false,"subtasks":"","subtasksState":false,"statement":"### Read problem statements in [Bengali](https:\/\/www.codechef.com\/download\/translated\/START4\/bengali\/SUBCENTR.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/START4\/mandarin\/SUBCENTR.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/START4\/russian\/SUBCENTR.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/START4\/vietnamese\/SUBCENTR.pdf) as well.\n\nYou are given a tree with $N$ nodes (numbered $1$ through $N$) and $Q$ queries (numbered $1$ through $Q$). For each valid $i$, in the $i$-th query, you are given $K_i$ nodes $x_1, x_2, \\ldots, x_{K_i}$. Consider the smallest subtree which contains all of these nodes; you should find all centers of this subtree.\n\nA node is called a *center* of a tree if it lies in the middle of at least one longest path in that tree. Note that there may be multiple longest paths (paths with the same maximum length) and for a longest path which contains an even number of nodes, there are two nodes lying in the middle of this path.\n\n**Note:** A subtree here refers to a connected subgraph of the tree. Selecting a node does not mean all its descendants have to be selected.\n\n### Input\n- The first line of the input contains a single integer $T$ denoting the number of test cases. The description of $T$ test cases follows.\n- The first line of each test case contains two space-separated integers $N$ and $Q$.\n- $N-1$ lines follow. For each valid $i$, the $i$-th of these lines contains two space-separated integers $u$ and $v$ denoting that there is an edge between nodes $u$ and $v$ in the tree.\n- $Q$ more lines follow. For each valid $i$, the $i$-th of these lines contains an integer $K_i$, followed by a space and $K_i$ space-separated integers $x_1, x_2, \\ldots, x_{K_i}$.\n\n**Note:** The input and output of this problem are large, so prefer using fast input\/output methods.\n\n### Output\nFor each query, print a single line containing an integer $C$ denoting the number of centers, followed by a space and $C$ space-separated integers \u2014 the nodes which are centers of the given subtree, sorted in increasing order.\n\n### Constraints\n- $1 \\le T \\le 10^5$\n- $1 \\leq N \\leq 10^5$\n- $1 \\leq u, v \\leq N$\n- the graph described on the input is a tree\n- $1 \\le Q \\le 10^6$\n- $1 \\leq x_i \\leq N$ for each valid $i$\n- for each query, $x_1, x_2, \\ldots, x_{K_i}$ are pairwise distinct\n- the sum of $N$ over all test cases does not exceed $5 \\cdot 10^5$\n- the sum of $K_i$ over all queries in all test cases does not exceed $10^6$","inputFormat":"","inputFormatState":false,"outputFormat":"","outputFormatState":false,"sampleTestCases":[{"id":"1","input":"2\n3 2\n1 2\n2 3\n2 1 3\n2 1 2\n5 2\n1 2\n2 3\n2 4\n3 5\n1 2\n2 4 5","output":"1 2\n2 1 2\n1 2\n2 2 3","explanation":"**Example case 1:** The figure below describes the second query. The smallest subtree containing the given nodes is coloured red and the nodes which are its centers are coloured blue.\n\n<img src=\"https:\/\/s3.amazonaws.com\/codechef_shared\/download\/Images\/DAANISH\/2.png\" width=\"450\" height=\"378\" \/>\n\n**Example case 2:** The figure below describes the second query with subtree and centers coloured in the same way.\n\n<img src=\"https:\/\/s3.amazonaws.com\/codechef_shared\/download\/Images\/DAANISH\/1.png\" width=\"450\" height=\"378\" \/>","isDeleted":false}]},"video_editorial_url":"https:\/\/youtu.be\/NCiqFEgFAC8","languages_supported":"CPP14, C, JAVA, PYTH 3.6, CPP17, PYTH, PYP3, CS2, ADA, PYPY, TEXT, PAS fpc, NODEJS, RUBY, PHP, GO, HASK, TCL, PERL, SCALA, LUA, kotlin, BASH, JS, LISP sbcl, rust, PAS gpc, BF, CLOJ, R, D, CAML, FORT, ASM, swift, FS, WSPC, LISP clisp, SQL, SCM guile, PERL6, ERL, CLPS, ICK, NICE, PRLG, ICON, COB, SCM chicken, PIKE, SCM qobi, ST, SQLQ, NEM","max_timelimit":"1.5","source_sizelimit":"50000","problem_author":"daanish_adm","problem_author_html_handle":"daanish_adm","problem_tester":"","problem_tester_html_handle":"","date_added":"13-05-2021","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/daanish_adm'>daanish_adm<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/easy-medium'>easy-medium<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/lowest-common-ancestor'>lowest-common-ancestor<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/start4'>start4<\/a>","problem_difficulty_level":"Easy-Medium","user_zen_mode":false,"best_tag":"Lowest Common Ancestor","editorial_url":"https:\/\/discuss.codechef.com\/problems\/SUBCENTR","time":{"view_start_date":1622381400,"submit_start_date":1622381400,"visible_start_date":1622381400,"end_date":1735669800,"current":1643797889},"user":{"username":null,"access":"default"},"todo":false,"problem_status":"unattempted","is_direct_submittable":false,"problemDiscussURL":"https:\/\/discuss.codechef.com\/search?q=SUBCENTR","is_proctored":false,"is_user_verified_for_proctoring":null,"visitedContests":[]}