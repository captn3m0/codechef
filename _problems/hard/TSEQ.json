{"category_name":"hard","status":"success","problem_code":"TSEQ","problem_name":"Tree Sequences","body":"### Read problem statements in [Hindi](https:\/\/www.codechef.com\/download\/translated\/AUG19\/hindi\/TSEQ.pdf), [Bengali](https:\/\/www.codechef.com\/download\/translated\/AUG19\/bengali\/TSEQ.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/AUG19\/mandarin\/TSEQ.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/AUG19\/russian\/TSEQ.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/AUG19\/vietnamese\/TSEQ.pdf) as well.\n\nYou are given a tree with $N$ vertices numbered $1$ through $N$. For each valid $i$, initially, vertex $i$ has value $W_i$. The value of each vertex can be either $-1$ or a non-negative integer.\n\nAt any time, let's denote the sequence of values of vertices on the path from vertex $u$ to vertex $v$ by $S(u, v)$. We are interested in replacing each element $-1$ in such a sequence by a non-negative integer (not necessarily the same for each $-1$).\n\nYou should process $Q$ queries of five types:\n- `UPDATE U X`: Change the value of vertex $U$ to $X$.\n- `INCREASING U V A B`: Find the number of ways to replace each $-1$ in the sequence $S(U, V)$ by an integer such that the resulting sequence is **strictly increasing** and contains only integers between $A$ and $B$ (inclusive).\n- `DECREASING U V A B`: Find the number of ways to replace each $-1$ in the sequence $S(U, V)$by an integer such that the resulting sequence is **strictly decreasing** and contains only integers between $A$ and $B$ (inclusive).\n- `NON-DECREASING U V A B`: Find the number of ways to replace each $-1$ in the sequence $S(U, V)$ by an integer such that the resulting sequence is **non-decreasing** and contains only integers between $A$ and $B$ (inclusive).\n- `NON-INCREASING U V A B`: Find the number of ways to replace each $-1$ in the sequence $S(U, V)$ by an integer such that the resulting sequence is **non-increasing** and contains only integers between $A$ and $B$ (inclusive).\n\n### Input\n- The first line of the input contains two space-separated integers $N$ and $Q$.\n- The second line contains $N$ space-separated integers $W_1, W_2, \\ldots, W_N$.\n- Each of the next $N-1$ lines contains two space-separated integers $U$ and $V$ denoting that vertices $U$ and $V$ are connected by an edge.\n- $Q$ lines follow. Each of these lines describes one query in the format given above.\n\n### Output\nFor each query except the `UPDATE` queries, print a single line containing one integer \u2015 the number of ways to replace each $-1$, modulo $10^9 + 7$.\n\n### Constraints\n- $1 \\le N, Q \\le 10^5$\n- $1 \\le U, V \\le N$\n- $-1 \\le W_i \\le 10^6$ for each valid $i$\n- $0 \\le A \\le B \\le 10^6$\n- $-1 \\le X \\le 10^6$\n\n### Subtasks\n**Subtask #1 (10 points):** $1 \\le N, Q \\le 1,000$\n\n**Subtask #2 (10 points):**\n- $W_i = -1$ for each valid $i$\n- $X = -1$\n\n**Subtask #3 (80 points):** original constraints\n\n### Example Input\n```\n8 3\n1 2 3 -1 -1 -1 -1 -1\n1 2\n2 3\n2 5\n2 6\n4 5\n5 7\n5 8\nINCREASING 1 5 1 10\nUPDATE 1 -1\nNON-DECREASING 1 5 0 10\n```\n\n### Example Output\n```\n8\n27\n```\n\n<aside style='background: #f8f8f8;padding: 10px 15px;'><div>All submissions for this problem are available.<\/div><\/aside>","problemComponents":{"constraints":"","constraintsState":false,"subtasks":"","subtasksState":false,"statement":"### Read problem statements in [Hindi](https:\/\/www.codechef.com\/download\/translated\/AUG19\/hindi\/TSEQ.pdf), [Bengali](https:\/\/www.codechef.com\/download\/translated\/AUG19\/bengali\/TSEQ.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/AUG19\/mandarin\/TSEQ.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/AUG19\/russian\/TSEQ.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/AUG19\/vietnamese\/TSEQ.pdf) as well.\n\nYou are given a tree with $N$ vertices numbered $1$ through $N$. For each valid $i$, initially, vertex $i$ has value $W_i$. The value of each vertex can be either $-1$ or a non-negative integer.\n\nAt any time, let's denote the sequence of values of vertices on the path from vertex $u$ to vertex $v$ by $S(u, v)$. We are interested in replacing each element $-1$ in such a sequence by a non-negative integer (not necessarily the same for each $-1$).\n\nYou should process $Q$ queries of five types:\n- `UPDATE U X`: Change the value of vertex $U$ to $X$.\n- `INCREASING U V A B`: Find the number of ways to replace each $-1$ in the sequence $S(U, V)$ by an integer such that the resulting sequence is **strictly increasing** and contains only integers between $A$ and $B$ (inclusive).\n- `DECREASING U V A B`: Find the number of ways to replace each $-1$ in the sequence $S(U, V)$by an integer such that the resulting sequence is **strictly decreasing** and contains only integers between $A$ and $B$ (inclusive).\n- `NON-DECREASING U V A B`: Find the number of ways to replace each $-1$ in the sequence $S(U, V)$ by an integer such that the resulting sequence is **non-decreasing** and contains only integers between $A$ and $B$ (inclusive).\n- `NON-INCREASING U V A B`: Find the number of ways to replace each $-1$ in the sequence $S(U, V)$ by an integer such that the resulting sequence is **non-increasing** and contains only integers between $A$ and $B$ (inclusive).\n\n### Input\n- The first line of the input contains two space-separated integers $N$ and $Q$.\n- The second line contains $N$ space-separated integers $W_1, W_2, \\ldots, W_N$.\n- Each of the next $N-1$ lines contains two space-separated integers $U$ and $V$ denoting that vertices $U$ and $V$ are connected by an edge.\n- $Q$ lines follow. Each of these lines describes one query in the format given above.\n\n### Output\nFor each query except the `UPDATE` queries, print a single line containing one integer \u2015 the number of ways to replace each $-1$, modulo $10^9 + 7$.\n\n### Constraints\n- $1 \\le N, Q \\le 10^5$\n- $1 \\le U, V \\le N$\n- $-1 \\le W_i \\le 10^6$ for each valid $i$\n- $0 \\le A \\le B \\le 10^6$\n- $-1 \\le X \\le 10^6$\n\n### Subtasks\n**Subtask #1 (10 points):** $1 \\le N, Q \\le 1,000$\n\n**Subtask #2 (10 points):**\n- $W_i = -1$ for each valid $i$\n- $X = -1$\n\n**Subtask #3 (80 points):** original constraints","inputFormat":"","inputFormatState":false,"outputFormat":"","outputFormatState":false,"sampleTestCases":[{"id":"1","input":"8 3\n1 2 3 -1 -1 -1 -1 -1\n1 2\n2 3\n2 5\n2 6\n4 5\n5 7\n5 8\nINCREASING 1 5 1 10\nUPDATE 1 -1\nNON-DECREASING 1 5 0 10","output":"8\n27","explanation":"","isDeleted":false}]},"video_editorial_url":"","languages_supported":"CPP14, C, JAVA, PYTH 3.6, PYTH, PYP3, CS2, ADA, PYPY, TEXT, PAS fpc, NODEJS, RUBY, PHP, GO, HASK, TCL, PERL, SCALA, LUA, kotlin, BASH, JS, LISP sbcl, rust, PAS gpc, BF, CLOJ, R, D, CAML, FORT, ASM, swift, FS, WSPC, LISP clisp, SQL, SCM guile, PERL6, ERL, CLPS, ICK, NICE, PRLG, ICON, COB, SCM chicken, PIKE, SCM qobi, ST, NEM","max_timelimit":"3","source_sizelimit":"50000","problem_author":"daniel_1999","problem_author_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #D0011B;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>7&#9733;<\/span><span class='m-username--link'>daniel_1999<\/span>","problem_tester":null,"problem_tester_html_handle":"","date_added":"1-05-2019","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/aug19'>aug19<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/combinatorics'>combinatorics<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/daniel_1999'>daniel_1999<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/hard'>hard<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/heavy-light-decomposition'>heavy-light-decomposition<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/segment-tree'>segment-tree<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/vijju123'>vijju123<\/a>","problem_difficulty_level":"Hard","user_zen_mode":false,"best_tag":"Segment Tree","editorial_url":"https:\/\/discuss.codechef.com\/problems\/TSEQ","time":{"view_start_date":1565602202,"submit_start_date":1565602202,"visible_start_date":1565602202,"end_date":1735669800,"current":1643798003},"user":{"username":null,"access":"default"},"todo":false,"problem_status":"unattempted","is_direct_submittable":false,"problemDiscussURL":"https:\/\/discuss.codechef.com\/search?q=TSEQ","is_proctored":false,"is_user_verified_for_proctoring":null,"visitedContests":[]}