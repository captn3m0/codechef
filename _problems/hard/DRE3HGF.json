{"category_name":"hard","status":"success","problem_code":"DRE3HGF","problem_name":"Dream and the Multiverse","body":"### Read problem statements in [Hindi](https:\/\/www.codechef.com\/download\/translated\/FEB21\/hindi\/DRE3HGF.pdf), [Bengali](https:\/\/www.codechef.com\/download\/translated\/FEB21\/bengali\/DRE3HGF.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/FEB21\/mandarin\/DRE3HGF.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/FEB21\/russian\/DRE3HGF.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/FEB21\/vietnamese\/DRE3HGF.pdf) as well.\r\n\r\nDream abstracts the fabric of spacetime as a directed rooted tree (arborescence) with $N$ nodes (numbered $1$ through $N$). Node $1$ is the root and for each $i$ ($1 \\le i \\le N-1$), the parent of node $i+1$ is $f_i$. All edges of this tree are directed away from the root.\r\n\r\nThen, Dream employs a magical superpower and adds $M$ directed edges to this tree in such a way that the resulting directed graph remains acyclic (a DAG).\r\n\r\nLet's call a node of this DAG an *event* and further call a simple path on this DAG an *era*. Dream considers a pair of events $(i,j)$ to be *plausible* if there is an era whose first event is $i$ and last event is $j$. Note that $i \\lt j$ does not have to hold for a plausible pair.\r\n\r\nDream now wants you to answer $Q$ queries. In each query, he gives you two positive integers $l$ and $r$, where $l \\leq r$, and he wishes to know the number of plausible pairs of events $(i,j)$ such that $l \\leq i \\lt j \\leq r$.\r\n\r\n### Input\r\n- The first line of the input contains two space-separated integers $N$ and $M$.\r\n- The second line contains $N-1$ space-separated integers $f_1, f_2, \\ldots, f_{N-1}$.\r\n- $M$ lines follow. Each of these lines contains two space-separated integers $u$ and $v$ describing an additional edge from node $u$ to node $v$.\r\n- The following line contains a single integer $Q$.\r\n- $Q$ lines follow. Each of these lines contains two space-separated integers $l$ and $r$ describing a query.\r\n\r\n### Output\r\nFor each query, print a single line containing one integer \u2015 the number of plausible pairs $(i,j)$ such that $l \\leq i \\lt j \\leq r$.\r\n\r\n### Constraints \r\n- $2 \\leq N \\leq 3 \\cdot 10^5$\r\n- $1 \\leq Q \\leq 3 \\cdot 10^5$\r\n- $0 \\leq M \\leq 20$\r\n- $1 \\le f_i \\le N$ for each valid $i$\r\n- $1 \\le u, v \\le N$\r\n- the graph described on the input is acyclic\r\n- $1 \\le l \\le r \\le N$\r\n\r\n### Subtasks\r\n**Subtask #1 (10 points):** the graph is a line \u2015 that is, $M = 0$ and there is a permutation $p_1,p_2,\\ldots,p_N$ such that $p_1=1$ and nodes $p_1,p_2,\\ldots,p_N$ form a directed path in the tree\r\n\r\n**Subtask #2 (20 points):** $M = 0$\r\n\r\n**Subtask #3 (30 points):** $N,Q \\leq 2 \\cdot 10^5$\r\n\r\n**Subtask #4 (40 points):** original constraints\r\n\r\n### Example Input\r\n```\r\n8 2\r\n1 2 5 1 4 3 3\r\n2 4\r\n4 7\r\n3\r\n4 6\r\n5 7\r\n1 8\r\n```\r\n\r\n### Example Output\r\n```\r\n2\r\n2\r\n18\r\n```\r\n\n<aside style='background: #f8f8f8;padding: 10px 15px;'><div>All submissions for this problem are available.<\/div><\/aside>","problemComponents":{"constraints":"","constraintsState":false,"subtasks":"","subtasksState":false,"statement":"### Read problem statements in [Hindi](https:\/\/www.codechef.com\/download\/translated\/FEB21\/hindi\/DRE3HGF.pdf), [Bengali](https:\/\/www.codechef.com\/download\/translated\/FEB21\/bengali\/DRE3HGF.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/FEB21\/mandarin\/DRE3HGF.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/FEB21\/russian\/DRE3HGF.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/FEB21\/vietnamese\/DRE3HGF.pdf) as well.\r\n\r\nDream abstracts the fabric of spacetime as a directed rooted tree (arborescence) with $N$ nodes (numbered $1$ through $N$). Node $1$ is the root and for each $i$ ($1 \\le i \\le N-1$), the parent of node $i+1$ is $f_i$. All edges of this tree are directed away from the root.\r\n\r\nThen, Dream employs a magical superpower and adds $M$ directed edges to this tree in such a way that the resulting directed graph remains acyclic (a DAG).\r\n\r\nLet's call a node of this DAG an *event* and further call a simple path on this DAG an *era*. Dream considers a pair of events $(i,j)$ to be *plausible* if there is an era whose first event is $i$ and last event is $j$. Note that $i \\lt j$ does not have to hold for a plausible pair.\r\n\r\nDream now wants you to answer $Q$ queries. In each query, he gives you two positive integers $l$ and $r$, where $l \\leq r$, and he wishes to know the number of plausible pairs of events $(i,j)$ such that $l \\leq i \\lt j \\leq r$.\r\n\r\n### Input\r\n- The first line of the input contains two space-separated integers $N$ and $M$.\r\n- The second line contains $N-1$ space-separated integers $f_1, f_2, \\ldots, f_{N-1}$.\r\n- $M$ lines follow. Each of these lines contains two space-separated integers $u$ and $v$ describing an additional edge from node $u$ to node $v$.\r\n- The following line contains a single integer $Q$.\r\n- $Q$ lines follow. Each of these lines contains two space-separated integers $l$ and $r$ describing a query.\r\n\r\n### Output\r\nFor each query, print a single line containing one integer \u2015 the number of plausible pairs $(i,j)$ such that $l \\leq i \\lt j \\leq r$.\r\n\r\n### Constraints \r\n- $2 \\leq N \\leq 3 \\cdot 10^5$\r\n- $1 \\leq Q \\leq 3 \\cdot 10^5$\r\n- $0 \\leq M \\leq 20$\r\n- $1 \\le f_i \\le N$ for each valid $i$\r\n- $1 \\le u, v \\le N$\r\n- the graph described on the input is acyclic\r\n- $1 \\le l \\le r \\le N$\r\n\r\n### Subtasks\r\n**Subtask #1 (10 points):** the graph is a line \u2015 that is, $M = 0$ and there is a permutation $p_1,p_2,\\ldots,p_N$ such that $p_1=1$ and nodes $p_1,p_2,\\ldots,p_N$ form a directed path in the tree\r\n\r\n**Subtask #2 (20 points):** $M = 0$\r\n\r\n**Subtask #3 (30 points):** $N,Q \\leq 2 \\cdot 10^5$\r\n\r\n**Subtask #4 (40 points):** original constraints","inputFormat":"","inputFormatState":false,"outputFormat":"","outputFormatState":false,"sampleTestCases":[{"id":"1","input":"8 2\r\n1 2 5 1 4 3 3\r\n2 4\r\n4 7\r\n3\r\n4 6\r\n5 7\r\n1 8","output":"2\r\n2\r\n18","explanation":"","isDeleted":false}]},"video_editorial_url":"https:\/\/youtu.be\/cqjyJK9Pn3s","languages_supported":"CPP14, C, JAVA, PYTH 3.6, CPP17, PYTH, PYP3, CS2, ADA, PYPY, TEXT, PAS fpc, NODEJS, RUBY, PHP, GO, HASK, TCL, PERL, SCALA, LUA, kotlin, BASH, JS, LISP sbcl, rust, PAS gpc, BF, CLOJ, R, D, CAML, FORT, ASM, swift, FS, WSPC, LISP clisp, SQL, SCM guile, PERL6, ERL, CLPS, ICK, NICE, PRLG, ICON, COB, SCM chicken, PIKE, SCM qobi, ST, SQLQ, NEM","max_timelimit":"2.5","source_sizelimit":"50000","problem_author":"piggydan","problem_author_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #1E7D22;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>2&#9733;<\/span><span class='m-username--link'>piggydan<\/span>","problem_tester":"","problem_tester_html_handle":"","date_added":"25-01-2021","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/feb21'>feb21<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/piggydan'>piggydan<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/super-hard'>super-hard<\/a>","problem_difficulty_level":"Super-Hard","user_zen_mode":false,"best_tag":"","editorial_url":"https:\/\/discuss.codechef.com\/problems\/DRE3HGF","time":{"view_start_date":1104528600,"submit_start_date":1104528600,"visible_start_date":1104528600,"end_date":1735669800,"current":1643797993},"user":{"username":null,"access":"default"},"todo":false,"problem_status":"unattempted","is_direct_submittable":false,"problemDiscussURL":"https:\/\/discuss.codechef.com\/search?q=DRE3HGF","is_proctored":false,"is_user_verified_for_proctoring":null,"visitedContests":[]}