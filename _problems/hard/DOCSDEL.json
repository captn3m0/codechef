
{"category_name":"hard","status":"success","problem_code":"DOCSDEL","problem_name":"Permutation Composition Queries","body":"<span class=\"solution-visible-txt\">All submissions for this problem are available.<\/span><h3>Read problems statements in <a target=\"_blank\" \nhref=\"http:\/\/www.codechef.com\/download\/translated\/LTIME61\/mandarin\/DOCSDEL.pdf\">Mandarin chinese<\/a>, <a target=\"_blank\" \nhref=\"http:\/\/www.codechef.com\/download\/translated\/LTIME61\/russian\/DOCSDEL.pdf\">Russian<\/a> and <a target=\"_blank\" \nhref=\"http:\/\/www.codechef.com\/download\/translated\/LTIME61\/vietnamese\/DOCSDEL.pdf\">Vietnamese<\/a> as well.<\/h3>\n\nYou are given $N$ sequences $P_1, P_2, \\dots, P_N$. Each of them is a permutation of numbers $1$ through $M$.\n\nLet's define a product of two permutations $X$ and $Y$ of numbers $1$ through $M$ as a permutation $Z = X\\cdot Y$ such that $Z_i=Y_{X_i}$ for each valid $i$.\n\nYou should answer $Q$ queries. Each query is described by two numbers $L$ and $R$. Let's define a permutation $B = P_L \\cdot P_{L+1} \\cdot \\,\\dots\\, \\cdot P_R$; the multiplication of permutations is evaluated left to right, i.e. as $((P_L \\cdot P_{L+1}) \\cdot \\dots) \\cdot P_R$. The answer to a query is $\\sum_{i=1}^M i \\cdot B_i$.\n\n### Input\n- The first line of the input contains a single integer $T$ denoting the number of test cases. The description of $T$ test cases follows.\n- The first line of each test case contains two space-separated integers $N$ and $M$.\n- $N$ lines follow. For each valid $i$, the $i$-th of these lines contains $M$ space-separated integers $P_{i, 1}, P_{i, 2}, \\dots, P_{i, M}$ denoting the permutation $P_i$.\n- The next line contains a single integer $Q$.\n- Each of the following $Q$ lines contains two space-separated integers $L$ and $R$ describing one query.\n\n### Output\nFor each test case, print $Q$ lines. For each valid $i$, the $i$-th of these lines should contain a single integer \u2014 the answer to the $i$-th query.\n\n### Constraints\n- $1 \\le T \\le 1,000$\n- $1 \\le N, M \\le 10^5$\n- $1 \\le N \\cdot M \\le 2 \\cdot 10^5$\n- $1 \\le P_{i, j} \\le M$ for each valid $i$ and $j$\n- $1 \\le Q \\le 2 \\cdot 10^5$\n- $1 \\le L \\le R \\le N$\n- for each valid $i$, $P_i$ is permutation of numbers $1$ through $M$\n- the sum of $N \\cdot M$ for all test cases does not exceed $2 \\cdot 10^5$\n- the sum of $Q$ for all test cases does not exceed $2 \\cdot 10^5$\n\n### Subtasks\n\n**Subtask #1 (15 points):**\n- $1 \\le T \\le 100$\n- $1 \\le Q \\le 50$\n- $1 \\le N \\cdot M \\le 200$\n\n**Subtask #2 (25 points):**\n- $1 \\le T \\le 100$\n- $1 \\le M \\le 10$\n\n**Subtask #3 (60 points):** original constraints\n\n### Example Input\n```\n1\n4 3\n3 2 1\n1 3 2\n1 2 3\n2 3 1\n5\n1 1\n1 4\n3 4\n3 3\n1 3\n```\n\n### Example Output\n```\n10\n11\n11\n14\n11\n```\n\n### Explanation\n**Example case 1:** \n- query 1: $B = [3, 2, 1]$, so the answer is $1\\cdot 3 + 2\\cdot 2 + 3\\cdot 1 = 10$\n- query 2: $B = [3, 1, 2]$, the answer is $11$\n- query 3: $B = [2, 3, 1]$, the answer is $11$\n- query 4: $B = [1, 2, 3]$, the answer is $14$\n- query 5: $B = [2, 3, 1]$, the answer is $11$\n","languages_supported":"C, CPP14, JAVA, PYTH, PYTH 3.6, PYPY, CS2, PAS fpc, PAS gpc, RUBY, PHP, GO, NODEJS, HASK, rust, SCALA, swift, D, PERL, FORT, WSPC, ADA, CAML, ICK, BF, ASM, CLPS, PRLG, ICON, SCM qobi, PIKE, ST, NICE, LUA, BASH, NEM, LISP sbcl, LISP clisp, SCM guile, JS, ERL, TCL, kotlin, PERL6, TEXT, SCM chicken, PYP3, CLOJ, COB, FS","max_timelimit":"2","source_sizelimit":"50000","problem_author":"isaf27","problem_author_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #D0011B;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>7&#9733;<\/span><span>isaf27<\/span>","problem_tester":null,"problem_tester_html_handle":"","date_added":"23-06-2018","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/complexity'>complexity<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/isaf27'>isaf27<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/isaf27'>isaf27<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/likecs'>likecs<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/ltime61'>ltime61<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/medium'>medium<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/prefix'>prefix<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/queries'>queries<\/a>","editorial_url":"https:\/\/discuss.codechef.com\/problems\/DOCSDEL","time":{"view_start_date":1530378005,"submit_start_date":1530378005,"visible_start_date":1530378005,"end_date":1735669800,"current":1559472990},"user":{"username":"","access":"default"},"todo":false,"problem_status":"unattempted","is_direct_submittable":false}