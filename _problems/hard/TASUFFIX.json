{"category_name":"hard","status":"success","problem_code":"TASUFFIX","problem_name":"Very Long Suffix Array","body":"<span class=\"solution-visible-txt\">All submissions for this problem are available.<\/span><p> Let S = s<sub>1<\/sub>, s<sub>2<\/sub>, ...,s<sub>n<\/sub> be a string and let S[i, j] denote the substring s<sub>i<\/sub>, s<sub>i+1<\/sub>, ... s<sub>j<\/sub>. The <b>suffix array<\/b> A of S is an array of integers giving the starting positions of suffixes of S in lexicographical order. This means, the entry A[i] contains the starting position of the i-th smallest(lexicographically) suffix of S. In other words, for all 1 &lt; i \u2264 n: S[A[i - 1], n] &lt; S[A[i], n].<\/p>\n<p>\nLet us take an example. Suppose S = \"12323\". Then all suffixes of S are \"12323\", \"2323\", \"323\", \"23\", \"3\". If we sort the suffixes lexicographically, we get \"12323\", \"23\", \"2323\", \"3\", \"323\". Therefore the suffix array, which gives the starting positions of suffixes in lexicographic order, will be A = 1, 4, 2, 5, 3.<\/p>\n<p>\nThere is exactly one suffix array for each string. However, several strings can give the  same suffix array. In this problem, given a suffix array A of length <b>N<\/b>, you have to calculate the number of strings S whose suffix array is A.<\/p>\n<p>\nHowever, N can be very large, so the array A is not given directly. You should initialize the array A as A[i] = i for all 1 \u2264 i \u2264 N and apply <b>M<\/b> operations to it in order to obtain the desired suffix array A. Each operation can be of one of the following types:\n<\/p>\n<ul>\n<li><b>0 u v<\/b>: Remove the sub-sequence A[u,v] and bring it to the front. After this operation, the N elements would be in the following order: <br\/> \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 A[u], A[u + 1], ...<br \/>\nA[v], A[1], A[2], ... A[u - 1], A[v + 1], A[v + 2], ... A[N].\n<\/br\/><\/li>\n<li><b>1 u v<\/b>: Flip A[u,v]. After this operation, the N elements would be in the following order: <br\/> \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 A[1], A[2], ... A[u-1], A[v], A[v-1], ... A[u+1], A[u], A[v+1], A[v+2], ... A[N].\n<\/br\/><\/li>\n<\/ul>\n\n<p>\nFor this problem, a string is <b>an array of positive integers<\/b>. Additionally, the number of different integers used in a string must be same as the largest integer in the string. For example: (1, 2, 2) and (4, 5, 1, 2, 3) are valid strings while (1, 1, 3) and (-1, 0, 1, 2) are not.\n<\/p>\n<p>\nSince the result can be extremely large, you just have to print it modulo <b>1,000,000,007(10<sup>9<\/sup> + 7) <\/b>\n<\/p>\n<h3>Input<\/h3>\n<p>The first line of the input contains 2 space separated integers, <b>N<\/b> and <b>M<\/b>. <b>N<\/b> is the length of suffix array, and <b>M<\/b> is the number of operations.<br \/>\nEach of the next <b>M<\/b> lines contains 3 space separated integers representing an operation of one of the two types.\n<\/p>\n<h3>Output<\/h3>\n<p>\nOutput a single line containing the number of strings corresponding to the given suffix array modulo <b>1,000,000,007(10<sup>9<\/sup> + 7) <\/b>.\n<\/p>\n<h3>Constraints<\/h3>\n<ul>\n<li><b>1<\/b> \u2264 <b>N<\/b> \u2264 <b>1,000,000,000 (10<sup>9<\/sup>)<\/b><\/li>\n<li><b>0<\/b> \u2264 <b>M<\/b> \u2264 <b>100,000 (10<sup>5<\/sup>)<\/b><\/li>\n<li>For all operations, <b>1<\/b> \u2264 <b>u<\/b> \u2264 <b>v<\/b> \u2264 <b>N<\/b><\/li>\n<\/ul>\n<h3>Example<\/h3>\n<pre><b>Input:<\/b>\n4 2\n1 2 3\n0 3 4\n<b>Output:<\/b>\n4\n<\/pre><h3>Explanation<\/h3>\n<p>\nThe initial array is (1, 2, 3, 4).<br \/>\nAfter the first operation the array becomes (1, 3, 2, 4).<br \/>\nAfter the second operation the array becomes (2, 4, 1, 3).<br \/>\nThe 4 possible strings are (2, 1, 2, 2), (2, 1, 3, 2), (3, 1, 3, 2), (3, 1, 4, 2).\n<\/p>\n","languages_supported":"ADA, ASM, BASH, BF, C, C99 strict, CAML, CLOJ, CLPS, CPP 4.3.2, CPP 4.9.2, CPP14, CS2, D, ERL, FORT, FS, GO, HASK, ICK, ICON, JAVA, JS, LISP clisp, LISP sbcl, LUA, NEM, NICE, NODEJS, PAS fpc, PAS gpc, PERL, PERL6, PHP, PIKE, PRLG, PYTH, PYTH 3.4, RUBY, SCALA, SCM guile, SCM qobi, ST, TCL, TEXT, WSPC","max_timelimit":"5","source_sizelimit":"50000","problem_author":"tuananh93","problem_author_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #FFBF00;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>5&#9733;<\/span><span>tuananh93<\/span>","problem_tester":"keshav_57","problem_tester_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #684273;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>4&#9733;<\/span><span>keshav_57<\/span>","date_added":"15-05-2013","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/binary-tree'>\n                    binary-tree\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/cook36'>\n                    cook36\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/hard'>\n                    hard\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/splay-tree'>\n                    splay-tree\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/tuananh93'>\n                    tuananh93\n                <\/a>","editorial_url":"http:\/\/discuss.codechef.com\/problems\/TASUFFIX","user":{"username":null},"time":{"view_start_date":1374431400,"submit_start_date":1374431400,"visible_start_date":1374431400,"end_date":1735669800,"current":1493556868},"todo":false,"problem_status":"unattempted"}