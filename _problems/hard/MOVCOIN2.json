{"category_name":"hard","status":"success","problem_code":"MOVCOIN2","problem_name":"Move the Coins 2","body":"### Read problem statements in [Hindi](https:\/\/www.codechef.com\/download\/translated\/SEPT20\/hindi\/MOVCOIN2.pdf), [Bengali](https:\/\/www.codechef.com\/download\/translated\/SEPT20\/bengali\/MOVCOIN2.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/SEPT20\/mandarin\/MOVCOIN2.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/SEPT20\/russian\/MOVCOIN2.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/SEPT20\/vietnamese\/MOVCOIN2.pdf)  as well.\r\n\r\nThis is a sequel to the problem [\"Move the Coins\"](https:\/\/www.hackerrank.com\/challenges\/move-the-coins\/problem) with a couple of twists!\r\n\r\nAlice and Bob are playing a board game. The board is a tree $T_{\\textit{board}}$ with $N$ nodes (numbered $1$ through $N$). The game involves moving some coins around the board. For a node $R$ ($1 \\le R \\le N$), let's define a game $g(T_{\\textit{board}}, R)$ with the following rules:\r\n1. Initially, a copy of $T_{\\textit{board}}$ is taken and for each valid $v$, $c_v$ coins are placed in the node $v$.\r\n2. Bob and Alice alternate turns; Alice plays first.\r\n3. In each turn, the current player must take a single coin from some node other than $R$ (let's denote it by $C$) and move it to another node which lies on the path between $R$ and $C$ (including $R$, but not including $C$).\r\n4. If a player cannot move a coin during their turn (i.e. all the coins are in the node $R$), this player loses the game.\r\n\r\nFor example, for the board in the figure below and $R=1$:\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_1.png)\r\n\r\nThe current player may take a coin from one of the nodes $2$, $4$ or $5$ (if there were any coins in node $3$, taking one of those would also be an option). If they take a coin from node $5$, they can move it $X$ steps towards the node $R=1$, where $X$ is either $1$, $2$ or $3$ and the coin ends up in the node $4$, $2$ or $1$, respectively:\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_2.png)\r\n\r\nLet's assume that they pick $X=2$, so they move the coin to node $2$. At the end of this turn, the board is\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_3.png)\r\n\r\nand it is the other player's turn.\r\n\r\nBoth players play optimally. Bob knows some elementary Game Theory, so he is able to very quickly predict the winner of any game. Unimpressed, Alice gives him a harder task: she challenges him to find the winner of $g(T_{\\textit{board}}, R)$ for each valid $R$ ($1 \\le R \\le N$).\r\n\r\nCan you help Bob figure out the answer? Specifically, if $W$ is the set of all valid $R$ such that the winner of $g(T_{\\textit{board}}, R)$ is Bob, then you must calculate $\\sum_{R \\in W} 2^R$ modulo $10^9+7$.\r\n\r\n### Input\r\n- The first line of the input contains a single integer $T$ denoting the number of test cases. The description of $T$ test cases follows.\r\n- The first line of each test case contains a single integer $N$.\r\n- Each of the next $N-1$ lines contains two space-separated integers $u$ and $v$ denoting that nodes $u$ and $v$ are connected by an edge.\r\n- The last line contains $N$ space-separated integers $c_1, c_2, \\ldots, c_N$.\r\n\r\n### Output\r\nFor each test case, print a single line containing one integer \u2015 the sum of $2^R$ over all valid $R$ such that the winner of $g(T_{\\textit{board}}, R)$ is Bob, modulo $10^9+7$.\r\n\r\n### Constraints \r\n- $1 \\le T \\le 1,000$\r\n- $1 \\le N \\le 300,000$\r\n- $1 \\le u, v \\le N$\r\n- $0 \\le c_i \\le 16$ for each valid $i$\r\n- the sum of $N$ over all test cases does not exceed $300,000$\r\n\r\n### Subtasks\r\n**Subtask #1 (5 points):** \r\n- $T \\le 10$\r\n- $N \\le 10$\r\n- $c_i \\le 6$ for each valid $i$\r\n- $c_1 + c_2 + \\ldots + c_N \\le 10$\r\n\r\n**Subtask #2 (10 points)**: \r\n- $T \\le 100$ \r\n- $N \\le 1,000$\r\n\r\n**Subtask #3 (85 points)**: original constraints\r\n\r\n### Example Input\r\n```\r\n2\r\n3 \r\n1 2\r\n2 3\r\n1 0 1\r\n6\r\n1 2\r\n1 3\r\n4 3\r\n3 5\r\n4 6\r\n0 2 2 1 3 2\r\n```\r\n\r\n### Example Output\r\n```\r\n4\r\n14\r\n```\r\n\r\n### Explanation\r\nAlthough the tree $T_{\\textit{board}}$ is undirected, arrows have been added along edges for clarity, indicating the directions in which coins must be moved for each $R$. The node $R$ itself is always highlighted in red.\r\n\r\n**Example case 1:** The original $T_{\\textit{board}}$ looks like this:\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_4.png)\r\n\r\nLet's examine the games for $R = 1,2,3$.\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_5.png)\r\n\r\nFor $R = 1$, Alice turns out to be the winner. On the first turn, she has two possible moves: move the coin from node $3$ to node $2$ or to node $1$. If she does the latter, then at the end of her turn, all coins are in node $R$, meaning that Bob is unable to move a coin during the next turn and Alice is the winner; since she is playing optimally, she does precisely that :)\r\n\r\nFor $R = 2$: Bob gets his revenge this time! Alice has two possible initial moves: move the coin from node $1$ to node $2$, or move the coin from node $3$ to node $2$. In either case, at the end of her turn, there is exactly one coin remaining in a node other than $R$. Bob merely has to move this coin to $R$ to leave Alice with no possible moves on her turn.\r\n\r\nFor $R = 3$, Alice wins again, using very similar reasoning to the $R = 1$ case (her winning move this time around is to move the coin from node $1$ to node $3$).\r\n\r\nWe've figured out the winner of $g(T_{\\textit{board}}, R)$ for all valid $R$, and it turns out that Bob only wins one game, when $R=2$; thus the answer is $2^2 \\,\\%\\, (10^9+7) = 4$.\r\n\r\n**Example case 2:** The original $T_{\\textit{board}}$ looks like this:\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_6.png)\r\n\r\nThe boards for $R = 1, 2, 3, 4, 5, 6$ are, respectively:\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_7.png)\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_8.png)\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_9.png)\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_10.png)\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_11.png)\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_12.png)\r\n\r\nIt can be proved that Bob wins $g(T_{\\textit{board}}, 1)$, $g(T_{\\textit{board}}, 2)$ and $g(T_{\\textit{board}}, 3)$, while Alice wins $g(T_{\\textit{board}}, 4)$, $g(T_{\\textit{board}}, 5)$ and $g(T_{\\textit{board}}, 6)$. The answer is $(2^1 + 2^2 + 2^3) \\,\\%\\, (10^9+7) = 14$.\r\n\r\n\r\n\n<aside style='background: #f8f8f8;padding: 10px 15px;'><div>All submissions for this problem are available.<\/div><\/aside>","problemComponents":{"constraints":"","constraintsState":false,"subtasks":"","subtasksState":false,"statement":"### Read problem statements in [Hindi](https:\/\/www.codechef.com\/download\/translated\/SEPT20\/hindi\/MOVCOIN2.pdf), [Bengali](https:\/\/www.codechef.com\/download\/translated\/SEPT20\/bengali\/MOVCOIN2.pdf), [Mandarin Chinese](https:\/\/www.codechef.com\/download\/translated\/SEPT20\/mandarin\/MOVCOIN2.pdf), [Russian](https:\/\/www.codechef.com\/download\/translated\/SEPT20\/russian\/MOVCOIN2.pdf), and [Vietnamese](https:\/\/www.codechef.com\/download\/translated\/SEPT20\/vietnamese\/MOVCOIN2.pdf)  as well.\r\n\r\nThis is a sequel to the problem [\"Move the Coins\"](https:\/\/www.hackerrank.com\/challenges\/move-the-coins\/problem) with a couple of twists!\r\n\r\nAlice and Bob are playing a board game. The board is a tree $T_{\\textit{board}}$ with $N$ nodes (numbered $1$ through $N$). The game involves moving some coins around the board. For a node $R$ ($1 \\le R \\le N$), let's define a game $g(T_{\\textit{board}}, R)$ with the following rules:\r\n1. Initially, a copy of $T_{\\textit{board}}$ is taken and for each valid $v$, $c_v$ coins are placed in the node $v$.\r\n2. Bob and Alice alternate turns; Alice plays first.\r\n3. In each turn, the current player must take a single coin from some node other than $R$ (let's denote it by $C$) and move it to another node which lies on the path between $R$ and $C$ (including $R$, but not including $C$).\r\n4. If a player cannot move a coin during their turn (i.e. all the coins are in the node $R$), this player loses the game.\r\n\r\nFor example, for the board in the figure below and $R=1$:\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_1.png)\r\n\r\nThe current player may take a coin from one of the nodes $2$, $4$ or $5$ (if there were any coins in node $3$, taking one of those would also be an option). If they take a coin from node $5$, they can move it $X$ steps towards the node $R=1$, where $X$ is either $1$, $2$ or $3$ and the coin ends up in the node $4$, $2$ or $1$, respectively:\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_2.png)\r\n\r\nLet's assume that they pick $X=2$, so they move the coin to node $2$. At the end of this turn, the board is\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_3.png)\r\n\r\nand it is the other player's turn.\r\n\r\nBoth players play optimally. Bob knows some elementary Game Theory, so he is able to very quickly predict the winner of any game. Unimpressed, Alice gives him a harder task: she challenges him to find the winner of $g(T_{\\textit{board}}, R)$ for each valid $R$ ($1 \\le R \\le N$).\r\n\r\nCan you help Bob figure out the answer? Specifically, if $W$ is the set of all valid $R$ such that the winner of $g(T_{\\textit{board}}, R)$ is Bob, then you must calculate $\\sum_{R \\in W} 2^R$ modulo $10^9+7$.\r\n\r\n### Input\r\n- The first line of the input contains a single integer $T$ denoting the number of test cases. The description of $T$ test cases follows.\r\n- The first line of each test case contains a single integer $N$.\r\n- Each of the next $N-1$ lines contains two space-separated integers $u$ and $v$ denoting that nodes $u$ and $v$ are connected by an edge.\r\n- The last line contains $N$ space-separated integers $c_1, c_2, \\ldots, c_N$.\r\n\r\n### Output\r\nFor each test case, print a single line containing one integer \u2015 the sum of $2^R$ over all valid $R$ such that the winner of $g(T_{\\textit{board}}, R)$ is Bob, modulo $10^9+7$.\r\n\r\n### Constraints \r\n- $1 \\le T \\le 1,000$\r\n- $1 \\le N \\le 300,000$\r\n- $1 \\le u, v \\le N$\r\n- $0 \\le c_i \\le 16$ for each valid $i$\r\n- the sum of $N$ over all test cases does not exceed $300,000$\r\n\r\n### Subtasks\r\n**Subtask #1 (5 points):** \r\n- $T \\le 10$\r\n- $N \\le 10$\r\n- $c_i \\le 6$ for each valid $i$\r\n- $c_1 + c_2 + \\ldots + c_N \\le 10$\r\n\r\n**Subtask #2 (10 points)**: \r\n- $T \\le 100$ \r\n- $N \\le 1,000$\r\n\r\n**Subtask #3 (85 points)**: original constraints","inputFormat":"","inputFormatState":false,"outputFormat":"","outputFormatState":false,"sampleTestCases":[{"id":"1","input":"2\r\n3 \r\n1 2\r\n2 3\r\n1 0 1\r\n6\r\n1 2\r\n1 3\r\n4 3\r\n3 5\r\n4 6\r\n0 2 2 1 3 2","output":"4\r\n14","explanation":"Although the tree $T_{\\textit{board}}$ is undirected, arrows have been added along edges for clarity, indicating the directions in which coins must be moved for each $R$. The node $R$ itself is always highlighted in red.\r\n\r\n**Example case 1:** The original $T_{\\textit{board}}$ looks like this:\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_4.png)\r\n\r\nLet's examine the games for $R = 1,2,3$.\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_5.png)\r\n\r\nFor $R = 1$, Alice turns out to be the winner. On the first turn, she has two possible moves: move the coin from node $3$ to node $2$ or to node $1$. If she does the latter, then at the end of her turn, all coins are in node $R$, meaning that Bob is unable to move a coin during the next turn and Alice is the winner; since she is playing optimally, she does precisely that :)\r\n\r\nFor $R = 2$: Bob gets his revenge this time! Alice has two possible initial moves: move the coin from node $1$ to node $2$, or move the coin from node $3$ to node $2$. In either case, at the end of her turn, there is exactly one coin remaining in a node other than $R$. Bob merely has to move this coin to $R$ to leave Alice with no possible moves on her turn.\r\n\r\nFor $R = 3$, Alice wins again, using very similar reasoning to the $R = 1$ case (her winning move this time around is to move the coin from node $1$ to node $3$).\r\n\r\nWe've figured out the winner of $g(T_{\\textit{board}}, R)$ for all valid $R$, and it turns out that Bob only wins one game, when $R=2$; thus the answer is $2^2 \\,\\%\\, (10^9+7) = 4$.\r\n\r\n**Example case 2:** The original $T_{\\textit{board}}$ looks like this:\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_6.png)\r\n\r\nThe boards for $R = 1, 2, 3, 4, 5, 6$ are, respectively:\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_7.png)\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_8.png)\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_9.png)\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_10.png)\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_11.png)\r\n\r\n![](https:\/\/codechef_shared.s3.amazonaws.com\/download\/Images\/SEPT20\/MOVCOIN2\/COUNTREE_12.png)\r\n\r\nIt can be proved that Bob wins $g(T_{\\textit{board}}, 1)$, $g(T_{\\textit{board}}, 2)$ and $g(T_{\\textit{board}}, 3)$, while Alice wins $g(T_{\\textit{board}}, 4)$, $g(T_{\\textit{board}}, 5)$ and $g(T_{\\textit{board}}, 6)$. The answer is $(2^1 + 2^2 + 2^3) \\,\\%\\, (10^9+7) = 14$.","isDeleted":false}]},"video_editorial_url":"","languages_supported":"CPP14, C, JAVA, PYTH 3.6, CPP17, PYTH, PYP3, CS2, ADA, PYPY, TEXT, PAS fpc, NODEJS, RUBY, PHP, GO, HASK, TCL, PERL, SCALA, LUA, kotlin, BASH, JS, LISP sbcl, rust, PAS gpc, BF, CLOJ, R, D, CAML, FORT, ASM, swift, FS, WSPC, LISP clisp, SQL, SCM guile, PERL6, ERL, CLPS, ICK, NICE, PRLG, ICON, COB, SCM chicken, PIKE, SCM qobi, ST, SQLQ, NEM","max_timelimit":"5","source_sizelimit":"50000","problem_author":"ssjgz","problem_author_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #FF7F00;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>6&#9733;<\/span><span class='m-username--link'>ssjgz<\/span>","problem_tester":"","problem_tester_html_handle":"","date_added":"17-04-2020","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/bitwise-operation'>bitwise-operation<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/centroid-decomposition'>centroid-decomposition<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/hard'>hard<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/sept20'>sept20<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/sprague-grundy'>sprague-grundy<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/ssjgz'>ssjgz<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/ssjgz'>ssjgz<\/a>, <a class='problem-tag-small ' href='\/tags\/problems\/xor'>xor<\/a>","problem_difficulty_level":"Hard","user_zen_mode":false,"best_tag":"Bitwise Operation","editorial_url":"https:\/\/discuss.codechef.com\/problems\/MOVCOIN2","time":{"view_start_date":1600075802,"submit_start_date":1600075802,"visible_start_date":1600075802,"end_date":1735669800,"current":1643797997},"user":{"username":null,"access":"default"},"todo":false,"problem_status":"unattempted","is_direct_submittable":false,"problemDiscussURL":"https:\/\/discuss.codechef.com\/search?q=MOVCOIN2","is_proctored":false,"is_user_verified_for_proctoring":null,"visitedContests":[]}