{"category_name":"hard","status":"success","problem_code":"WALKBT","problem_name":"Walks on the binary tree","body":"<span class=\"solution-visible-txt\">All submissions for this problem are available.<\/span><h3>Read problems statements in <a target=\"_blank\" \nhref=\"http:\/\/www.codechef.com\/download\/translated\/AUG17\/mandarin\/WALKBT.pdf\">mandarin chinese<\/a>, <a target=\"_blank\" \nhref=\"http:\/\/www.codechef.com\/download\/translated\/AUG17\/russian\/WALKBT.pdf\">russian<\/a> and <a target=\"_blank\" \nhref=\"http:\/\/www.codechef.com\/download\/translated\/AUG17\/vietnamese\/WALKBT.pdf\">vietnamese<\/a> as well.<\/h3>\n\n<p> You have a <a href = https:\/\/xlinux.nist.gov\/dads\/HTML\/perfectBinaryTree.html>perfect binary tree<\/a> of height <b>N<\/b>. That is, it contains 2<sup><b>N<\/b>+1<\/sup> - 1 nodes.<\/p>\n\n<p>A path from the root to a leaf can be represented by an integer <b>X<\/b> which lies between 0 and 2<sup><b>N<\/b><\/sup> - 1 (both inclusive) as follows:<\/p>\n<p>Consider the <b>N<\/b> length binary representation of <b>X<\/b>. Start reading from the left, and at each bit, 0 denotes going to the left child, and 1 denotes going to the right child. For eg. if <b>N<\/b> = 2, and <b>X<\/b> = 0 = (00)<sub>2<\/sub>, it would correspond to the path which goes to the leftmost leaf. <b>X<\/b> = 3 = (11)<sub>2<\/sub> would correspond to the path from root to the rightmost leaf.<\/p>\n \n<p>At the beginning, <b>X<\/b> = 0, and you have visited only the root till now. Then, you get <b>Q<\/b> queries. A query can be of two types:<\/p>\n\n<ul>\n<li>Type 1: \"! <b>C<\/b>\": This means that <b>X<\/b> has to be changed to <b>X<\/b> = ( <b>X<\/b> + 2<sup><b>C<\/b><\/sup> ) mod 2<sup><b>N<\/b><\/sup>, and then you start from the root, and walk down the route represented by the new <b>X<\/b>.<\/li>\n<li>Type 2: \"?\": This means that you should print the number of nodes that you have visited at least once.<\/li>\n<\/ul>\n\n\n<h3>Input<\/h3>\n<ul>\n<li>The first line contains a single integer <b>T<\/b>, which denotes the number of testcases. The description of each testcase follows.<\/li>\n<li>The first line of each testcase contains two integers: <b>N<\/b> and <b>Q<\/b>, which denote the height of the tree and the number of the queries respectively.<\/li>\n<li><b>Q<\/b> lines follow, which are the descriptions of the queries. Each line will either be a \"! <b>C<\/b>\" or a \"?\" (without quotes).<\/li>\n<\/ul>\n\n<h3>Output<\/h3>\n<p>For each query of Type 2, you have to print one integer in a new line<\/p>\n\n<h3>Constraints<\/h3>\n<ul>\n<li>1 \u2264 <b> T <\/b> \u2264 10<\/li>\n<li>1 \u2264 <b> N, Q <\/b> \u2264  10<sup>5<\/sup><\/li>\n<li> 0 \u2264 <b> C <\/b> < <b> N <\/b> <\/li>\n<li>The sum of <b>N<\/b> over all testcases does not exceed 10<sup>5<\/sup>, and sum of <b>Q<\/b> over all testcases does not exceed 10<sup>5<\/sup><\/li> \n\n<\/ul>\n\n\n<h3>Subtasks<\/h3>\n<ul>\n<li><b>Subtask 1<\/b> (30 points) : The sum of <b>N<\/b> over all testcases does not exceed 2000, and sum of <b>Q<\/b> over all testcases does not exceed 2000<\/li> \n<li><b>Subtask 2<\/b> (70 points) : Original constraints<\/li>\n<\/ul>\n\n<h3>Example<\/h3>\n<pre><b>Input<\/b>:\n1\n2 9\n! 0\n?\n! 1\n?\n! 0\n?\n! 0\n! 0\n? \n\n<b>Output<\/b>:\n3\n5\n6\n7\n<\/pre>\n\n<h3>Explanation<\/h3>\n<p>Let us label the tree nodes as follows:<\/p>\n\n<p><\/p>\n<img src=\"https:\/\/codechef_shared.s3.amazonaws.com\/download\/upload\/AUG17\/puush-linux%2B%282017-08-04%2Bat%2B02.32.03%29.png\" height=\"150\"\/>\n<p><\/p>\n\n<p>The node 0 corresponds to the root.<\/p>\n<p>At the beginning, <b>X<\/b> = 0, and then after the first query, <b>X<\/b> becomes 0 + 2<sup>0<\/sup> mod 4 = 1 = (01)<sub>2<\/sub>. The path 0 - 1 - 4 is traveled along.<\/p>\n<p>The next query asks for the number of visited nodes, which is 3.<\/p>\n<p>In the third query, <b>X<\/b> becomes 1 + 2<sup>1<\/sup> mod 4 = 3 = (11)<sub>2<\/sub>. The path 0 - 2 - 6 is traveled along.<\/p>\n<p>The fourth query asks for the number of visited nodes. The visited nodes are {0, 1, 4, 2, 6}. Hence the answer is 5.<\/p>\n<p>In the fifth query, <b>X<\/b> becomes 3 + 2<sup>0<\/sup> mod 4 = 0 = (00)<sub>2<\/sub>. The path 0 - 1 - 3 is traveled along.<\/p>\n<p>The sixth query asks for the number of visited nodes. The visited nodes are {0, 1, 4, 2, 6, 3}. Hence the answer is 6.<\/p>\n<p>In the seventh query, <b>X<\/b> becomes 0 + 2<sup>0<\/sup> mod 4 = 1 = (01)<sub>2<\/sub>. The path 0 - 1 - 4 is traveled along.<\/p>\n<p>In the eight query, <b>X<\/b> becomes 1 + 2<sup>0<\/sup> mod 4 = 2 = (10)<sub>2<\/sub>. The path 0 - 2 - 5 is traveled along.<\/p>\n<p>The ninth query asks for the number of visited nodes. The visited nodes are {0, 1, 4, 2, 6, 3, 5}. Hence the answer is 7.<\/p>\n","languages_supported":"ADA, ASM, BASH, BF, C, C99 strict, CAML, CLOJ, CLPS, CPP 4.3.2, CPP 6.3, CPP14, CS2, D, ERL, FORT, FS, GO, HASK, ICK, ICON, JAVA, JS, kotlin, LISP clisp, LISP sbcl, LUA, NEM, NICE, NODEJS, PAS fpc, PAS gpc, PERL, PERL6, PHP, PIKE, PRLG, PYPY, PYTH, PYTH 3.5, RUBY, rust, SCALA, SCM chicken, SCM guile, SCM qobi, ST, swift, TCL, TEXT, WSPC","max_timelimit":"3","source_sizelimit":"50000","problem_author":"altruist_","problem_author_html_handle":"<span \n            class='rating' \n            style='display: inline-block; \n                    font-size: 10px; \n                    background: #684273;\n                    padding: 0 3px; \n                    line-height: 1.3; \n                    color: white;\n                    margin-right: 2px;'>4&#9733;<\/span><span>altruist_<\/span>","problem_tester":null,"problem_tester_html_handle":"","date_added":"21-07-2017","tags":"<a class='problem-tag-small ' href='\/tags\/problems\/altruist_'>\n                    altruist_\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/aug17'>\n                    aug17\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/data-structure'>\n                    data-structure\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/hard'>\n                    hard\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/lazypropagation'>\n                    lazypropagation\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/persistence'>\n                    persistence\n                <\/a><a class='problem-tag-small ' href='\/tags\/problems\/segment-tree'>\n                    segment-tree\n                <\/a>","editorial_url":"https:\/\/discuss.codechef.com\/problems\/WALKBT","time":{"view_start_date":1503048600,"submit_start_date":1503048600,"visible_start_date":1503048600,"end_date":1735669800,"current":1514816035},"user":{"username":null},"todo":false,"problem_status":"unattempted"}